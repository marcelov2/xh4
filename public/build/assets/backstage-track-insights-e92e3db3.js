import{aJ as je,cb as sa,cc as ms,r as u,cd as Ee,m as I,ce as _e,cf as ta,cg as be,ch as ve,ci as zs,cj as Ms,a as G,j as s,R as We,c as S,n as aa,ap as xs,aU as st,aV as tt,aW as at,$ as Ie,ck as na,cl as ra,cm as Ls,l as Ge,cn as ns,co as rs,cp as he,cq as ye,cr as nt,f as te,be as ae,o as Qe,cs as J,ct as ia,cu as la,cv as oa,cw as ca,cx as da,cy as ua,cz as ma,q as Y,I as q,K as xa,u as oe,aQ as rt,cA as it,cB as fa,ah as lt,ai as ot,T as d,w as fs,Q as Ze,J as V,x as Ce,z as De,A as Je,b as ne,bf as Ye,d as L,al as Pe,g as hs,t as _,S as ha,k as ps,W as gs,ab as ke,U as pe,a7 as ct,cC as pa,c3 as ga,cD as ja,cE as ba,ay as js,P as va,cF as ya,ca as ka,h as Oe,D as X,G as Se,aS as Us,X as wa,cG as R,au as Na,E as Ia,bh as Ca,cH as Da,V as bs,Z as ce,a1 as Pa,b1 as Es,bl as Sa,a0 as ee,cI as Aa,b0 as Ta,ae as Xe,v as M,_ as de,a6 as Ae,B as re,aC as Te,at as ue,ax as me,b9 as vs,aw as ys,y as ks,ad as dt,a4 as ut,a5 as mt,a2 as xt,a8 as Z,aH as ft,L as Fa,bH as Va,bG as $a,N as ht,cJ as pt,c1 as Ra,aB as es,aa as za,bJ as Ma,ak as La,aR as Ua,cK as Ea,bR as _a,bS as _s,b7 as gt,bc as Oa,b8 as jt,Y as Ha}from"./main-7e78f4ad.js";import{K as qa,L as Ba,S as bt,A as ws,C as vt,a0 as Ka,G as Ns,j as Wa,s as He,X as yt,B as Ga,v as qe,D as Qa,a as Is,u as Za,V as kt,x as Ja,J as wt,n as Ya,k as ss,h as Cs,y as ts,r as Xa,a1 as en,O as sn,T as tn,l as Ds,F as Be,z as an,b as nn,c as rn,d as ln,e as Re,f as on,g as ze,Y as cn,R as Nt,w as dn,t as Os,P as un,U as mn,i as It}from"./play-arrow-filled-25316649.js";import{E as Ps}from"./Edit-345571e8.js";function Ct(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}function H(e){return e.set({hour:24-1,minute:60-1,second:60-1,millisecond:1e3-1})}function xn(){var a,n,r;const e=(a=je())==null?void 0:a.settings.dates.default_timezone,t=((r=(n=je())==null?void 0:n.user)==null?void 0:r.timezone)||e||"auto";return!t||t==="auto"?sa():t}function Fe(){const e=ms();return u.useMemo(()=>{try{return Ee(e)}catch{return Ee("UTC")}},[e])}function fn(){const e=xn();try{return Ee(e)}catch{return Ee("UTC")}}const F=Ct(fn());var Xs,et;const is=((et=(Xs=je())==null?void 0:Xs.i18n)==null?void 0:et.language)||"en",Dt=[{key:0,label:I("Today"),getRangeValue:()=>({preset:0,start:F,end:H(F)})},{key:1,label:I("Yesterday"),getRangeValue:()=>({preset:1,start:F.subtract({days:1}),end:H(F).subtract({days:1})})},{key:2,label:I("This week"),getRangeValue:()=>({preset:2,start:_e(F,is),end:ta(H(F),is)})},{key:3,label:I("Last week"),getRangeValue:()=>{const e=_e(F,is).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:I("Last 7 days"),getRangeValue:()=>({preset:4,start:F.subtract({days:7}),end:H(F)})},{key:6,label:I("Last 30 days"),getRangeValue:()=>({preset:6,start:F.subtract({days:30}),end:H(F)})},{key:7,label:I("Last 3 months"),getRangeValue:()=>({preset:7,start:F.subtract({months:3}),end:H(F)})},{key:8,label:I("Last 12 months"),getRangeValue:()=>({preset:8,start:F.subtract({months:12}),end:H(F)})},{key:9,label:I("This month"),getRangeValue:()=>({preset:9,start:be(F),end:ve(H(F))})},{key:10,label:I("This year"),getRangeValue:()=>({preset:10,start:zs(F),end:Ms(H(F))})},{key:11,label:I("Last year"),getRangeValue:()=>({preset:11,start:zs(F).subtract({years:1}),end:Ms(H(F)).subtract({years:1})})}],Pt=G(s.jsx("path",{d:"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z"}),"DateRangeOutlined"),St=We.forwardRef((e,t)=>{const{children:a,inputProps:n,wrapperProps:r,className:i,autoFocus:c,style:l,onClick:o}=e;return s.jsx("div",{...r,onClick:o,children:s.jsx("div",{...n,role:"group",className:S(i,"flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60"),ref:t,style:l,children:s.jsx(aa,{autoFocus:c,children:a})})})}),At=We.forwardRef(({inputRef:e,wrapperProps:t,children:a,onBlur:n,...r},i)=>{const c=xs(r),l=st(i),{fieldProps:o,inputProps:f}=tt({...r,focusRef:l,labelElementType:"span"});return c.wrapper=S(c.wrapper,r.disabled&&"pointer-events-none"),s.jsx(at,{wrapperProps:Ie(t,{onBlur:x=>{var m;(m=l.current)!=null&&m.contains(x.relatedTarget)||n==null||n(x)},onClick:()=>{const x=na(l);x==null||x.focusFirst()}}),fieldClassNames:c,ref:l,...o,children:s.jsx(St,{inputProps:f,className:S(c.input,"gap-10"),ref:e,children:a})})});function hn(e){return e instanceof ra?"day":"minute"}function cs(e,t,a){return t!=null&&e.compare(t)<0||a!=null&&e.compare(a)>0}function se(e,t,a){try{return Ls(e,t,a)}catch{return Ls(e,"UTC",a)}}function Tt(e,t){const a=ms(),[n,r]=u.useState(!1),i=t.closeDialogOnSelection??!0,c=t.granularity||hn(e),l=t.min?se(t.min,a):void 0,o=t.max?se(t.max,a):void 0;return{timezone:a,granularity:c,min:l,max:o,calendarIsOpen:n,setCalendarIsOpen:r,closeDialogOnSelection:i}}function Hs(e){var le,Q;const t=Fe(),[a,n]=u.useState({start:(!e.value||!e.value.start)&&!((le=e.defaultValue)!=null&&le.start),end:(!e.value||!e.value.end)&&!((Q=e.defaultValue)!=null&&Q.end)}),r=e.onChange,[i,c]=Ge(e.value?os(e.value,t):void 0,e.value?void 0:os(e.defaultValue,t),v=>{n({start:!1,end:!1}),r==null||r(v)}),{min:l,max:o,granularity:f,timezone:x,calendarIsOpen:m,setCalendarIsOpen:p,closeDialogOnSelection:h}=Tt(i.start,e),g=u.useCallback(()=>{n({start:!0,end:!0}),c(os(null,t)),r==null||r(null),p(!1)},[t,c,r,p]),[j,y]=u.useState(null),[k,w]=u.useState(!1),[A,D]=u.useState(i),[z,O]=u.useState(()=>qs(i,o)),b=u.useCallback(v=>{let N=v.start,T=v.end;l&&(N=ns(N,l));const U=o?rs(o,T):T;N=rs(N,U);const fe=l?ns(l,N):N;return T=ns(T,fe),o&&(T=rs(T,o)),{start:se(N,x),end:se(T,x)}},[l,o,x]),C=u.useCallback(v=>{const N={...b(v),preset:v.preset};c(N),D(N),O(qs(N,o)),n({start:!1,end:!1})},[c,b,o]),P=u.useCallback(v=>!a.start&&he(v,A.start)||!a.end&&he(v,A.end),[A,a]),$=u.useCallback(v=>(k||!a.start&&!a.end)&&v.compare(A.start)>=0&&v.compare(A.end)<=0,[A,a,k]),K=u.useCallback(v=>he(v,A.start),[A]),B=u.useCallback(v=>he(v,A.end),[A]),ie=u.useCallback((v,N)=>({onPointerEnter:()=>{k&&N&&D(ls({start:j,end:v,timezone:x}))},onClick:()=>{if(!k)w(!0),y(v),D(ls({start:v,end:v,timezone:x}));else{const T=ls({start:j,end:v,timezone:x});T.start=Ct(T.start),T.end=H(T.end),w(!1),y(null),C==null||C(T),h&&(p==null||p(!1))}}}),[j,k,C,p,h,x]);return{selectedValue:i,setSelectedValue:C,calendarIsOpen:m,setCalendarIsOpen:p,dayIsActive:P,dayIsHighlighted:$,dayIsRangeStart:K,dayIsRangeEnd:B,getCellProps:ie,calendarDates:z,setIsPlaceholder:n,isPlaceholder:a,clear:g,setCalendarDates:O,min:l,max:o,granularity:f,timezone:x,closeDialogOnSelection:h}}function qs(e,t){let a=ye(be(e.start)),n=ye(ve(e.end));return nt(a,n)&&(n=ve(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=be(a.subtract({months:1}))),[a,n]}function ls(e){const t=se(e.start,e.timezone),a=se(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function os(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}const pn=G(s.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z"}),"ArrowRightAltOutlined");function gn(e,t,a,n){switch(t){case"era":case"year":case"month":case"day":return e.cycle(t,a,{round:t==="year"})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return e.set({hour:i?r-12:r+12})}case"hour":case"minute":case"second":return e.cycle(t,a,{round:t!=="hour",hourCycle:n.hour12?12:24})}return e}function jn(e,t,a,n){switch(t){case"day":case"month":case"year":return e.set({[t]:a})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return a>=12===i?e:e.set({hour:i?r-12:r+12})}case"hour":if(n.hour12){const i=e.hour>=12;!i&&a===12&&(a=0),i&&a<12&&(a+=12)}case"minute":case"second":return e.set({[t]:a})}return e}const Bs={year:5,month:2,day:7,hour:2,minute:15,second:15,dayPeriod:1};function bn({segment:e,domProps:t,value:a,onChange:n,isPlaceholder:r,state:{timezone:i,calendarIsOpen:c,setCalendarIsOpen:l}}){const o=te(),f=u.useRef(""),{localeCode:x}=ae(),m=Qe(),p=J({timeZone:i}),h=u.useMemo(()=>new ia(x,{maximumFractionDigits:0}),[x]),g=b=>{n(jn(a,e.type,b,p.resolvedOptions()))},j=b=>{n(gn(a,e.type,b,p.resolvedOptions()))},y=()=>{if(h.isValidPartialNumber(e.text)){const b=e.text.slice(0,-1),C=h.parse(b);if(b.length===0||C===0){const P=la(i);e.type in P&&g(P[e.type])}else g(C);f.current=b}else e.type==="dayPeriod"&&j(-1)},k=b=>{var C;if(!(b.ctrlKey||b.metaKey||b.shiftKey||b.altKey)){switch(b.key){case"ArrowLeft":b.preventDefault(),b.stopPropagation(),m==null||m.focusPrevious();break;case"ArrowRight":b.preventDefault(),b.stopPropagation(),m==null||m.focusNext();break;case"Enter":(C=b.target.closest("form"))==null||C.requestSubmit(),l(!c);break;case"Tab":break;case"Backspace":case"Delete":{b.preventDefault(),b.stopPropagation(),y();break}case"ArrowUp":b.preventDefault(),f.current="",j(1);break;case"ArrowDown":b.preventDefault(),f.current="",j(-1);break;case"PageUp":b.preventDefault(),f.current="",j(Bs[e.type]||1);break;case"PageDown":b.preventDefault(),f.current="",j(-(Bs[e.type]||1));break;case"Home":b.preventDefault(),f.current="",g(e.maxValue);break;case"End":b.preventDefault(),f.current="",g(e.minValue);break}z(b.key)}},w=J({hour:"numeric",hour12:!0}),A=u.useMemo(()=>{const b=new Date;return b.setHours(0),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),D=u.useMemo(()=>{const b=new Date;return b.setHours(12),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),z=b=>{const C=f.current+b;switch(e.type){case"dayPeriod":if(A.toLowerCase().startsWith(b))g(0);else if(D.toLowerCase().startsWith(b))g(12);else break;m==null||m.focusNext();break;case"day":case"hour":case"minute":case"second":case"month":case"year":{if(!h.isValidPartialNumber(C))return;let P=h.parse(C),$=P,K=e.minValue===0;if(e.type==="hour"&&p.resolvedOptions().hour12){switch(p.resolvedOptions().hourCycle){case"h11":P>11&&($=h.parse(b));break;case"h12":K=!1,P>12&&($=h.parse(b));break}e.value>=12&&P>1&&(P+=12)}else P>e.maxValue&&($=h.parse(b));if(Number.isNaN(P))return;const B=$!==0||K;B&&g($),+`${P}0`>e.maxValue||C.length>=String(e.maxValue).length?(f.current="",B&&(m==null||m.focusNext())):f.current=C;break}}},O=o?{}:{"aria-label":e.type,"aria-valuetext":r?void 0:`${e.value}`,"aria-valuemin":e.minValue,"aria-valuemax":e.maxValue,"aria-valuenow":r?void 0:e.value,tabIndex:0,onKeyDown:k};return s.jsx("div",{...Ie(t,{...O,onFocus:b=>{f.current="",b.target.scrollIntoView({block:"nearest"})},onClick:b=>{b.preventDefault(),b.stopPropagation()}}),className:"box-content cursor-default select-none whitespace-nowrap rounded p-2 text-center tabular-nums caret-transparent outline-none focus:bg-primary focus:text-on-primary",children:e.text.padStart(e.minLength,"0")})}function vn({segment:e,domProps:t}){const a=Qe();return s.jsx("div",{...t,onPointerDown:n=>{n.pointerType==="mouse"&&(n.preventDefault(),a!=null&&a.focusNext({from:n.target})||a==null||a.focusPrevious({from:n.target}))},"aria-hidden":!0,className:"min-w-4 cursor-default select-none",children:e.text})}function yn(e,t,a){switch(t){case"year":return{value:e.year,placeholder:"yyyy",minValue:1,maxValue:e.calendar.getYearsInEra(e)};case"month":return{value:e.month,placeholder:"mm",minValue:ca(e),maxValue:e.calendar.getMonthsInYear(e)};case"day":return{value:e.day,minValue:oa(e),maxValue:e.calendar.getDaysInMonth(e),placeholder:"dd"}}if("hour"in e)switch(t){case"dayPeriod":return{value:e.hour>=12?12:0,minValue:0,maxValue:12,placeholder:"--"};case"hour":if(a.hour12){const n=e.hour>=12;return{value:e.hour,minValue:n?12:0,maxValue:n?23:11,placeholder:"--"}}return{value:e.hour,minValue:0,maxValue:23,placeholder:"--"};case"minute":return{value:e.minute,minValue:0,maxValue:59,placeholder:"--"}}return{}}function ds({segmentProps:e,state:t,value:a,onChange:n,isPlaceholder:r}){const{granularity:i}=t,c=u.useMemo(()=>{const x={year:"numeric",month:"numeric",day:"numeric"};return i==="minute"&&(x.hour="numeric",x.minute="numeric"),x},[i]),l=J(c),o=u.useMemo(()=>a.toDate(),[a]),f=u.useMemo(()=>l.formatToParts(o).map(x=>{const m=yn(a,x.type,l.resolvedOptions()),p=r&&x.type!=="literal"?m.placeholder:x.value;return{type:x.type,text:x.value===", "?" ":p,...m,minLength:x.type!=="literal"?String(m.maxValue).length:1}}),[o,l,r,a]);return s.jsx("div",{className:"flex items-center",children:f.map((x,m)=>x.type==="literal"?s.jsx(vn,{domProps:e,segment:x},m):s.jsx(bn,{isPlaceholder:r,domProps:e,state:t,value:a,onChange:n,segment:x},m))})}function kn({date:e,currentMonth:t,state:{dayIsActive:a,dayIsHighlighted:n,dayIsRangeStart:r,dayIsRangeEnd:i,getCellProps:c,timezone:l,min:o,max:f}}){const{localeCode:x}=ae(),m=da(e,x),p=a(e),h=n(e),g=r(e),j=i(e),y=ua(e,l),k=nt(e,t),w=cs(e,o,f);return s.jsxs("div",{role:"button","aria-disabled":w,className:S("relative isolate h-40 w-40 flex-shrink-0 text-sm",w&&"pointer-events-none text-disabled",!k&&"pointer-events-none invisible"),...c(e,k),children:[s.jsx("span",{className:S("absolute inset-0 z-10 flex h-full w-full cursor-pointer select-none items-center justify-center rounded-full",!p&&!y&&"hover:bg-hover",p&&"bg-primary font-semibold text-on-primary",y&&!p&&"bg-chip"),children:e.day}),h&&k&&s.jsx("span",{className:S("absolute inset-0 h-full w-full bg-primary/focus",(g||m===0||e.day===1)&&"rounded-l-full",(j||m===6||e.day===t.calendar.getDaysInMonth(t))&&"rounded-r-full")})]})}function wn({startDate:e,state:t,isFirst:a,isLast:n}){const{localeCode:r}=ae(),i=ma(e,r),c=_e(e,r);return s.jsxs("div",{className:"w-280 flex-shrink-0",children:[s.jsx(Nn,{isFirst:a,isLast:n,state:t,currentMonth:e}),s.jsxs("div",{className:"block",role:"grid",children:[s.jsx(In,{state:t,startDate:e}),[...new Array(i).keys()].map(l=>s.jsx(Y.div,{className:"mb-6 flex",children:[...new Array(7).keys()].map(o=>s.jsx(kn,{date:c.add({weeks:l,days:o}),currentMonth:e,state:t},o))},l))]})]})}function Nn({currentMonth:e,isFirst:t,isLast:a,state:{calendarDates:n,setCalendarDates:r,timezone:i,min:c,max:l}}){const o=p=>{const h=n.length;let g;p==="forward"?g=n.map(j=>ve(j.add({months:h}))):g=n.map(j=>ve(j.subtract({months:h}))),r(g)},f=J({month:"long",year:"numeric",era:e.calendar.identifier!=="gregory"?"long":void 0,calendar:e.calendar.identifier}),x=cs(e.subtract({days:1}),c,l),m=cs(be(e.add({months:1})),c,l);return s.jsxs("div",{className:"flex items-center justify-between gap-10",children:[s.jsx(q,{size:"md",className:S("text-muted",!t&&"invisible"),disabled:!t||x,"aria-hidden":!t,onClick:()=>{o("backward")},children:s.jsx(xa,{})}),s.jsx("div",{className:"select-none text-sm font-semibold",children:f.format(e.toDate(i))}),s.jsx(q,{size:"md",className:S("text-muted",!a&&"invisible"),disabled:!a||m,"aria-hidden":!a,onClick:()=>{o("forward")},children:s.jsx(qa,{})})]})}function In({state:{timezone:e},startDate:t}){const{localeCode:a}=ae(),n=J({weekday:"short"}),r=_e(t,a);return s.jsx("div",{className:"flex",children:[...new Array(7).keys()].map(i=>{const l=r.add({days:i}).toDate(e),o=n.format(l);return s.jsx("div",{className:"relative h-40 w-40 flex-shrink-0 text-sm font-semibold",children:s.jsx("div",{className:"absolute flex h-full w-full select-none items-center justify-center",children:o})},i)})})}function Ft({state:e,visibleMonths:t=1}){return te()&&(t=1),s.jsx(u.Fragment,{children:[...new Array(t).keys()].map(n=>{const r=ye(be(e.calendarDates[n])),i=n===0,c=n===t-1;return s.jsx(wn,{state:e,startDate:r,isFirst:i,isLast:c},n)})})}const Vt=u.memo(({start:e,end:t,options:a,preset:n})=>{const{dates:r}=oe(),i=ms(),c=J(a||rt[n||(r==null?void 0:r.format)]);if(!e||!t)return null;let l;try{l=c.formatRange(Ks(e,i),Ks(t,i))}catch{l=""}return s.jsx(u.Fragment,{children:l})},it);function Ks(e,t){return typeof e=="string"?fa(e,t).toDate():"toDate"in e?e.toDate(t):e}function Cn({onPresetSelected:e,selectedValue:t}){return s.jsx(lt,{children:Dt.map(a=>s.jsx(ot,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(d,{...a.label})},a.key))})}const $t=[{key:0,label:I("Preceding period"),getRangeValue:e=>{const t=e.start,r=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:r}),end:t}}},{key:1,label:I("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:I("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function Dn({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(lt,{children:$t.map(n=>s.jsx(ot,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const r=n.getRangeValue(e);t(r)},children:s.jsx(d,{...n.label})},n.key))})}function Pn({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const r=Ba(),{close:i}=fs(),c=u.useRef(e),l=e.isPlaceholder.start||e.isPlaceholder.end,[o,f]=u.useState(n),x=s.jsxs(Ze,{dividerTop:!0,startAction:!l&&!r?s.jsx("div",{className:"text-xs",children:s.jsx(Vt,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(V,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(c.current.selectedValue),e.setIsPlaceholder(c.current.isPlaceholder),i()},children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const m=e.selectedValue;t&&o&&(m.compareStart=t.selectedValue.start,m.compareEnd=t.selectedValue.end),i(m)},children:s.jsx(d,{message:"Select"})})]});return s.jsxs(Ce,{size:"auto",children:[s.jsxs(De,{className:"flex",padding:"p-0",children:[!r&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(Cn,{selectedValue:e.selectedValue,onPresetSelected:m=>{e.setSelectedValue(m),e.closeDialogOnSelection&&i(m)}}),!!t&&s.jsxs(u.Fragment,{children:[s.jsx(bt,{className:"mx-20 mb-10 mt-14",checked:o,onChange:m=>f(m.target.checked),children:s.jsx(d,{message:"Compare"})}),o&&s.jsx(Dn,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:m=>{t.setSelectedValue(m)}})]})]}),s.jsx(Je,{initial:!1,children:s.jsx(Sn,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:o})})]}),!e.closeDialogOnSelection&&x]})}function Sn({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(Y.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(Ws,{state:e}),!!t&&n&&s.jsx(Ws,{state:t,label:s.jsx(d,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(Ft,{state:e,visibleMonths:2})})]})}function Ws({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(At,{className:"mb-20 mt-10",label:t,children:[s.jsx(ds,{state:e,value:a.start,onChange:r=>{n({...a,start:r})}}),s.jsx(pn,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(ds,{state:e,value:a.end,onChange:r=>{n({...a,end:r})}})]})}const xe=(e,t)=>{const a=e.split("/");return t&&a.push(t),a};function vi(e,t,a,n){return t.paginate||(t.paginate="preferLengthAware"),ne({queryKey:xe(e,t),queryFn:({signal:r})=>An(e,t,n,r),placeholderData:Ye,...a})}async function An(e,t,a,n){t.query&&await new Promise(i=>setTimeout(i,300));const r=await L.get(e,{params:t,signal:t.query?n:void 0}).then(i=>i.data);return a==null||a(r),r}function Rt(e,t,a){return ne({queryKey:[e,t],queryFn:()=>Tn(e,t),placeholderData:Ye,...a})}async function Tn(e,t){return L.get(e,{params:t}).then(a=>a.data)}function zt(e,t,a){return ne({queryKey:[e,t],queryFn:()=>Fn(e,t),...a})}async function Fn(e,t){return L.get(e,{params:t}).then(a=>a.data)}function Vn({label:e,className:t,background:a,value:n,defaultValue:r="",placeholder:i=I("Select item..."),searchPlaceholder:c=I("Find an item..."),onChange:l,description:o,errorMessage:f,invalid:x,autoFocus:m,queryParams:p,endpoint:h,disabled:g,required:j}){var C;const y=u.useRef(null),[k,w]=u.useState(""),[A,D]=Ge(n,r,l),z=Rt(h,{query:k,...p}),{trans:O}=_(),b=xs({size:"md"});return A?s.jsxs("div",{className:t,children:[s.jsx("div",{className:b.label,children:e}),s.jsx("div",{className:S("rounded-input border p-8",a,x&&"border-danger"),children:s.jsx(Je,{initial:!1,mode:"wait",children:s.jsx($n,{disabled:g,endpoint:h,modelId:A,queryParams:p,onEditClick:()=>{D(""),w(""),requestAnimationFrame(()=>{var P,$;(P=y.current)==null||P.focus(),($=y.current)==null||$.click()})}})})}),o&&!f&&s.jsx("div",{className:b.description,children:o}),f&&s.jsx("div",{className:b.error,children:f})]}):s.jsx(ha,{className:t,showSearchField:!0,invalid:x,errorMessage:f,description:o,color:"white",isAsync:!0,background:a,placeholder:O(i),searchPlaceholder:O(c),label:e,isLoading:z.isFetching,items:(C=z.data)==null?void 0:C.results,inputValue:k,onInputValueChange:w,selectionMode:"single",selectedValue:A,onSelectionChange:D,ref:y,autoFocus:m,disabled:g,required:j,children:P=>s.jsx(ps,{value:P.id,description:P.description,startIcon:s.jsx(ws,{src:P.image}),children:P.name},P.id)})}function $n({modelId:e,onEditClick:t,endpoint:a,disabled:n,queryParams:r}){const{data:i,isLoading:c}=zt(`${a}/${e}`,r);return c||!(i!=null&&i.model)?s.jsx(Rn,{},"skeleton"):s.jsxs(Y.div,{className:S("flex items-center gap-10",n&&"pointer-events-none cursor-not-allowed text-disabled"),...gs,children:[i.model.image&&s.jsx(ws,{src:i.model.image}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm leading-4",children:i.model.name}),s.jsx("div",{className:"text-xs text-muted",children:i.model.description})]}),s.jsx(ke,{label:s.jsx(d,{message:"Change item"}),children:s.jsx(q,{className:"ml-auto text-muted",size:"sm",onClick:t,disabled:n,children:s.jsx(Ps,{})})})]},"preview")}function Rn(){return s.jsxs(Y.div,{className:"flex items-center gap-10",...gs,children:[s.jsx(pe,{variant:"rect",size:"w-32 h-32"}),s.jsxs("div",{className:"max-h-[36px] flex-auto",children:[s.jsx(pe,{className:"text-xs"}),s.jsx(pe,{className:"max-h-8 text-xs"})]}),s.jsx(pe,{variant:"icon",size:"w-24 h-24"})]})}function zn({name:e,...t}){const{clearErrors:a}=Pe(),{field:{onChange:n,value:r=""},fieldState:{invalid:i,error:c}}=hs({name:e});return s.jsx(Vn,{value:r,onChange:l=>{n(l),a(e)},invalid:i,errorMessage:c==null?void 0:c.message,...t})}function us(e){return{id:e,name:`${e}`,description:`${e}`}}function Mn(e,t){const a=u.useRef(null),n=st(t),{displayWith:r=U=>U.name,validateWith:i,children:c,suggestions:l,isLoading:o,inputValue:f,onInputValueChange:x,onItemSelected:m,placeholder:p,onOpenChange:h,chipSize:g="sm",openMenuOnFocus:j=!0,showEmptyMessage:y,value:k,defaultValue:w,onChange:A,valueKey:D,isAsync:z,allowCustomValue:O=!0,showDropdownArrow:b,onChipClick:C,...P}=e,$=xs({...e,flexibleHeight:!0}),[K,B]=En(e),[ie,le]=u.useState(!1),Q=s.jsx(js,{isIndeterminate:!0,size:"sm","aria-label":"loading..."}),v=b?s.jsx(va,{}):null,{fieldProps:N,inputProps:T}=tt({...P,focusRef:n,endAdornment:o&&ie?Q:v});return s.jsx(at,{fieldClassNames:$,...N,children:s.jsxs(St,{ref:a,className:S("flex flex-wrap items-center",$.input),onClick:()=>{var U;(U=n.current)==null||U.focus()},children:[s.jsx(Ln,{displayChipUsing:r,onChipClick:C,items:K,setItems:B,chipSize:g}),s.jsx(Un,{size:e.size,showEmptyMessage:y,inputProps:T,inputValue:f,onInputValueChange:x,fieldRef:a,inputRef:n,chips:K,setChips:B,validateWith:i,isLoading:o,suggestions:l,placeholder:p,openMenuOnFocus:j,listboxIsOpen:ie,setListboxIsOpen:le,allowCustomValue:O,children:c})]})})}function Ln({items:e,setItems:t,displayChipUsing:a,chipSize:n,onChipClick:r}){const i=Qe(),c=u.useCallback(l=>{const o=e.findIndex(x=>x.id===l),f=[...e];return o>-1&&(f.splice(o,1),t(f)),f},[e,t]);return s.jsx(vt,{className:S("max-w-full flex-shrink-0 flex-wrap",n==="xs"?"my-6":"my-8"),size:n,selectable:!0,children:e.map(l=>s.jsx(ct,{errorMessage:l.errorMessage,adornment:l.image?s.jsx(ws,{circle:!0,src:l.image}):null,onClick:()=>r==null?void 0:r(l),onRemove:()=>{c(l.id).length?i==null||i.focusPrevious({tabbable:!0}):i==null||i.focusLast()},children:a(l)},l.id))})}function Un(e){const{inputRef:t,fieldRef:a,validateWith:n,setChips:r,chips:i,suggestions:c,inputProps:l,placeholder:o,openMenuOnFocus:f,listboxIsOpen:x,setListboxIsOpen:m,allowCustomValue:p,isLoading:h,size:g}=e,j=Qe(),y=u.useCallback(v=>{v=(v||[]).filter(N=>{const T=!N||!N.id||!N.name;return!(i.findIndex(fe=>fe.id===(N==null?void 0:N.id))>-1)&&!T}),v.length&&(n&&(v=v.map(N=>n(N))),r([...i,...v]))},[i,r,n]),k=pa({...e,clearInputOnItemSelection:!0,isOpen:x,onOpenChange:m,items:c,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:v=>{B(v)}}),{state:{activeIndex:w,setActiveIndex:A,isOpen:D,setIsOpen:z,inputValue:O,setInputValue:b},refs:C,listboxId:P,collection:$,onInputChange:K}=k,B=v=>{const N=$.size&&w!=null?[...$.values()][w]:null;N!=null&&N.item?y([N.item]):p&&y([us(N?N.value:v)]),b(""),A(null),z(!1)};ga(()=>{a.current&&C.reference.current!==a.current&&k.reference(a.current)},[a,k,C]);const{handleTriggerKeyDown:ie,handleListboxKeyboardNavigation:le}=ya(k),Q=ka(()=>{f&&!D&&z(!0)});return s.jsx(ja,{listbox:k,mobileOverlay:ba,isLoading:h,onPointerDown:v=>{v.preventDefault()},children:s.jsx("input",{type:"text",className:S("mx-8 my-4 min-w-30 flex-[1_1_60px] bg-transparent text-sm outline-none",g==="xs"?"h-20":"h-30"),placeholder:o,...Ie(l,{ref:t,value:O,onChange:K,onPaste:v=>{const T=v.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(T){v.preventDefault();const U=window.getSelection();U!=null&&U.rangeCount&&(U.deleteFromDocument(),y(T.map(fe=>us(fe))))}},"aria-autocomplete":"list","aria-controls":D?P:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:v=>{const N=v.target;if(v.key==="Enter"){v.preventDefault(),B(N.value);return}if(v.key==="Escape"&&D&&(z(!1),b("")),v.key==="ArrowUp"&&D&&(w===0||w==null)){A(null);return}if(w!=null&&(v.key==="ArrowLeft"||v.key==="ArrowRight")){v.preventDefault();return}if((v.key==="ArrowLeft"||v.key==="Backspace"||v.key==="Delete")&&N.selectionStart===0&&w==null&&i.length){j==null||j.focusPrevious({tabbable:!0});return}ie(v)||le(v)},onFocus:Q,onClick:Q})})})}function En({onChange:e,value:t,defaultValue:a,valueKey:n}){const r=u.useMemo(()=>Gs(t),[t]),i=u.useMemo(()=>Gs(a),[a]),c=u.useCallback(l=>{const o=n?l.map(f=>f[n]):l;e==null||e(o)},[e,n]);return Ge(r||void 0,i||[],c)}function Gs(e){if(e!=null)return e.map(t=>typeof t!="object"?us(t):t)}const _n=We.forwardRef(Mn);function Mt({children:e,...t}){const{field:{onChange:a,onBlur:n,value:r=[],ref:i},fieldState:{invalid:c,error:l}}=hs({name:t.name}),o={onChange:a,onBlur:n,value:r,invalid:c,errorMessage:l==null?void 0:l.message};return s.jsx(_n,{ref:i,...Ie(o,t),children:e})}function On(e){const t=Fe(),[a,n]=u.useState(!e.value&&!e.defaultValue),r=e.onChange,[i,c]=Ge(e.value||t,e.defaultValue||t,D=>{n(!1),r==null||r(D)}),{min:l,max:o,granularity:f,timezone:x,calendarIsOpen:m,setCalendarIsOpen:p,closeDialogOnSelection:h}=Tt(i,e),g=u.useCallback(()=>{n(!0),c(t),r==null||r(null),p(!1)},[t,c,r,p]),[j,y]=u.useState(()=>[ye(i)]),k=u.useCallback(D=>{l&&D.compare(l)<0?D=l:o&&D.compare(o)>0&&(D=o);const z=i?i.set(D):se(D,x);c(z),y([ye(z)]),n(!1)},[c,l,o,i,x]),w=u.useCallback(D=>!a&&he(i,D),[i,a]),A=u.useCallback(D=>({onClick:()=>{k==null||k(D),h&&(p==null||p(!1))}}),[k,p,h]);return{selectedValue:i,setSelectedValue:c,calendarIsOpen:m,setCalendarIsOpen:p,dayIsActive:w,dayIsHighlighted:()=>!1,dayIsRangeStart:()=>!1,dayIsRangeEnd:()=>!1,getCellProps:A,calendarDates:j,setCalendarDates:y,isPlaceholder:a,clear:g,setIsPlaceholder:n,min:l,max:o,granularity:f,timezone:x,closeDialogOnSelection:h}}function Hn({showCalendarFooter:e,...t}){const a=On(t),n=u.useRef(null),r=Fe(),i=e&&s.jsx(Ze,{padding:"px-14 pb-14",startAction:s.jsx(V,{disabled:a.isPlaceholder,variant:"text",color:"primary",onClick:()=>{a.clear()},children:s.jsx(d,{message:"Clear"})}),children:s.jsx(V,{variant:"text",color:"primary",onClick:()=>{a.setSelectedValue(r),a.setCalendarIsOpen(!1)},children:s.jsx(d,{message:"Today"})})}),c=s.jsx(X,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:n,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsxs(Ce,{size:"auto",children:[s.jsx(De,{className:"flex items-start gap-40",padding:e?"px-24 pt-20 pb-10":null,children:s.jsx(Ft,{state:a,visibleMonths:1})}),i]})}),l={onClick:o=>{o.stopPropagation(),o.preventDefault(),Bn(o)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}};return s.jsxs(u.Fragment,{children:[s.jsx(At,{ref:n,wrapperProps:l,endAdornment:s.jsx(Pt,{className:S(t.disabled&&"text-disabled")}),...t,children:s.jsx(ds,{segmentProps:l,state:a,value:a.selectedValue,onChange:a.setSelectedValue,isPlaceholder:a.isPlaceholder})}),c]})}function qn(e){const{min:t,max:a}=e,{trans:n}=_(),{format:r}=J(),{field:{onChange:i,onBlur:c,value:l=null,ref:o},fieldState:{invalid:f,error:x}}=hs({name:e.name,rules:{validate:h=>{if(!h)return;const g=Oe(h);if(t&&g.compare(t)<0)return n({message:"Enter a date after :date",values:{date:r(h)}});if(a&&g.compare(a)>0)return n({message:"Enter a date before :date",values:{date:r(h)}})}}}),m=l?Oe(l):null,p={onChange:h=>{i(h&&h.toAbsoluteString())},onBlur:c,value:m,invalid:f,errorMessage:x==null?void 0:x.message,inputRef:o};return s.jsx(Hn,{...Ie(p,e)})}function Bn(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}const Kn=G(s.jsx("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandleOutlined");function Wn(){const[e,t]=u.useState(!1),a=u.useRef(),n=u.useCallback(r=>{var i;if(r){const c=new IntersectionObserver(([l])=>t(l.intersectionRatio<1),{threshold:[1]});a.current=c,c.observe(r)}else a.current&&((i=a.current)==null||i.disconnect())},[]);return{isSticky:e,sentinelRef:n}}function Ve({onSubmit:e,form:t,title:a,subTitle:n,children:r,actions:i,backButton:c,isLoading:l=!1,disableSaveWhenNotDirty:o=!1,wrapInContainer:f=!0,submitButtonText:x}){const{isSticky:m,sentinelRef:p}=Wn(),h=o?Object.keys(t.formState.dirtyFields).length:!0;return s.jsxs(Se,{onSubmit:e,onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx("div",{ref:p}),s.jsx("div",{className:S("sticky top-0 z-10 my-12 transition-shadow md:my-24",m&&"bg shadow"),children:s.jsxs("div",{className:S("flex items-center gap-24 py-14 md:items-start",f&&"container mx-auto px-24"),children:[c,s.jsxs("div",{className:"overflow-hidden overflow-ellipsis md:mr-64",children:[s.jsx("h1",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-xl md:text-3xl",children:a}),n&&s.jsx("div",{className:"mt-4",children:n})]}),s.jsx("div",{className:"mr-auto"}),i,s.jsx(V,{variant:"flat",color:"primary",type:"submit",disabled:l||!h,children:x??s.jsx(d,{message:"Save"})})]})}),s.jsx("div",{className:f?"container mx-auto px-24 pb-24":void 0,children:s.jsx("div",{className:"rounded",children:r})})]})}const Lt=""+new URL("music-7a11c2fe.svg",import.meta.url).href;function Gn(e){return ne({queryKey:["artists","search-suggestions",e],queryFn:()=>Qn(e),placeholderData:Ye})}async function Qn(e){return L.get("search/suggestions/artist",{params:e}).then(t=>t.data)}function Ut({name:e,className:t}){const{trans:a}=_(),[n,r]=u.useState(""),{data:i,isLoading:c}=Gn({query:n});return s.jsx(Mt,{className:t,name:e,label:s.jsx(d,{message:"Artists"}),isAsync:!0,inputValue:n,onInputValueChange:r,suggestions:i==null?void 0:i.results,placeholder:a(I("+Add artist")),isLoading:c,allowCustomValue:!1,children:i==null?void 0:i.results.map(l=>s.jsx(ps,{value:l,startIcon:l.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:l.image,alt:""}):void 0,children:l.name},l.id))})}function we({name:e,label:t,placeholder:a,model:n,className:r,allowCustomValue:i=!1}){const[c,l]=u.useState(""),{data:o,isLoading:f}=Rt(`normalized-models/${n}`,{query:c});return s.jsx(Mt,{className:r,name:e,label:t,isAsync:!0,inputValue:c,onInputValueChange:l,suggestions:o==null?void 0:o.results,placeholder:a,isLoading:f,allowCustomValue:i,children:o==null?void 0:o.results.map(x=>s.jsx(ps,{value:x,startIcon:x.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:x.image,alt:""}):void 0,children:x.name},x.id))})}const Et="tag",_t=G(s.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z"}),"FileUploadOutlined");function Ot({fileUpload:e,status:t,className:a}){const n=(e==null?void 0:e.bytesUploaded)||0,r=u.useMemo(()=>Us(e.file.size),[e.file.size]),i=u.useMemo(()=>Us(n),[n]);let c;return t==="completed"?c=s.jsx(d,{message:"Upload complete"}):t==="aborted"?c=s.jsx(d,{message:"Upload cancelled"}):t==="failed"?c=s.jsx(d,{message:"Upload failed"}):t==="processing"?c=s.jsx(d,{message:"Processing upload..."}):t==="pending"?c=s.jsx(d,{message:"Waiting to start..."}):c=s.jsx(d,{message:":bytesUploaded of :totalBytes uploaded",values:{bytesUploaded:i,totalBytes:r}}),s.jsx("div",{className:S("text-xs text-muted",a),children:c})}function Ht({fileUpload:e,status:t,onAbort:a,size:n="md",className:r}){return s.jsxs("div",{className:r,children:[s.jsxs("div",{className:"flex items-center justify-between gap-24",children:[s.jsx(Ot,{fileUpload:e,status:t}),s.jsx(Zn,{fileUpload:e,status:t,onAbort:a})]}),s.jsx(wa,{size:n==="sm"?"xs":"sm",radius:"rounded-sm",value:e.percentage,isIndeterminate:t==="processing"||t==="pending"})]})}function Zn({fileUpload:e,status:t,onAbort:a}){R(i=>i.abortUpload),R(i=>i.clearInactive);const n=e.errorMessage;let r;if(t==="failed"){const i=n||I("This file could not be uploaded");r=s.jsx(Me,{children:s.jsx(ke,{variant:"danger",label:s.jsx(Na,{value:i}),children:s.jsx(Ia,{className:"text-danger",size:"sm"})})})}else t==="aborted"?r=s.jsx(Me,{children:s.jsx(Ca,{className:"text-warning",size:"sm"})}):t==="completed"||t==="processing"?r=s.jsx(Me,{children:s.jsx(Da,{size:"sm",className:"text-primary"})}):a?r=s.jsx(Me,{children:s.jsx(q,{size:"xs",onClick:()=>a(e.file.id),children:s.jsx(bs,{})})}):r=s.jsx("div",{className:"h-30 w-30"});return s.jsx(Je,{children:r})}function Me({children:e,...t}){return s.jsx(Y.div,{className:"flex h-30 w-30 items-center justify-center",...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function Jn(){return ce({mutationFn:e=>Yn(e),onError:e=>Pa(e)})}function Yn(e){return L.post(`tracks/${e.fileEntryId}/extract-metadata`,e).then(t=>Xn(t.data))}function Xn(e){const t={name:e.metadata.title,duration:e.metadata.duration,genres:e.metadata.genres||[],description:e.metadata.comment,lyric:e.metadata.lyrics,release_date:e.metadata.release_date,album_name:e.metadata.album_name};return e.metadata.album&&(t.album_id=e.metadata.album.id),e.metadata.artist&&(t.artists=[e.metadata.artist]),e.metadata.image&&(t.image=e.metadata.image.url),t}function qt(e,t){var a,n;!((a=e.getValues("artists"))!=null&&a.length)&&t.artists&&e.setValue("artists",t.artists),!e.getValues("image")&&t.image&&e.setValue("image",t.image),t.release_date&&e.setValue("release_date",t.release_date),(n=t.genres)!=null&&n.length&&e.setValue("genres",Ue(e.getValues("genres"),t.genres)),!e.getValues("name")&&t.album_name&&e.setValue("name",t.album_name)}function Ne(e,t){return{...t,...e,artists:Ue(t.artists,e.artists),genres:Ue(t.genres,e.genres,"name"),tags:Ue(t.tags,e.tags,"name")}}function Ue(e=[],t=[],a="id"){return t=t.filter(n=>!e.find(r=>r[a]===n[a])),[...e,...t]}const er=50*1024*1024;function as(e){const{uploads:t}=oe(),a=u.useMemo(()=>({allowedFileTypes:[Es.audio,Es.video],maxFileSize:t.max_size||er}),[t.max_size]),n=Jn(),r=u.useRef(e);r.current=e;const i=R(h=>h.uploadMultiple),c=R(h=>h.updateFileUpload),l=R(h=>h.getUpload),o=u.useCallback((h,g)=>{var j;c(h,{meta:{...((j=l(h))==null?void 0:j.meta)||{},...g}})},[c,l]),f=u.useMemo(()=>({metadata:{diskPrefix:"track_media",disk:Sa.public},restrictions:a,onSuccess:(h,g)=>{o(g.id,{isExtractingMetadata:!0}),n.mutate({fileEntryId:h.id,autoMatchAlbum:r.current.autoMatchAlbum},{onSuccess:j=>{o(g.id,{isExtractingMetadata:!1});const y={...j,src:h.url};r.current.onMetadataChange(g,y)},onError:()=>{o(g.id,{isExtractingMetadata:!1})}})},onError:h=>{h&&ee.danger(h)}}),[n,o,a]),x=u.useCallback(h=>{const g=h.filter(j=>!Aa(j,a));return h.length!==g.length&&ee.danger(I(":count of your files is not supported.",{values:{count:h.length-g.length}})),g},[a]),m=u.useCallback(async h=>{if(x(h).length){h.forEach(j=>{var y,k;(k=(y=r.current).onUploadStart)==null||k.call(y,{name:j.name,uploadId:j.id})}),i(h,f);for(const j of h){o(j.id,{isGeneratingWave:!0});const y=await Ka(j.native);y&&r.current.onMetadataChange(j,{waveData:y}),o(j.id,{isGeneratingWave:!1})}}},[f,i,o,x]);return{openFilePicker:u.useCallback(async()=>{const h=await Ta({multiple:!0,types:a.allowedFileTypes});await m(h)},[m,a]),uploadTracks:m,validateUploads:x}}function Ss(e){const t=R(r=>e?r.fileUploads.get(e):null);let a=!1,n;if(t){const r=t.meta,i=(r==null?void 0:r.isExtractingMetadata)||(r==null?void 0:r.isGeneratingWave);a=(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="inProgress"||!!i,n=(t==null?void 0:t.status)==="completed"&&i?"processing":t==null?void 0:t.status}return{isUploading:a,status:n,activeUpload:t}}function sr(){const[e,t]=u.useState(),{setValue:a,watch:n,getValues:r}=Pe(),{openFilePicker:i}=as({onUploadStart:({uploadId:m})=>t(m),onMetadataChange:(m,p)=>{const h=Ne(p,r());Object.entries(h).forEach(([g,j])=>a(g,j,{shouldDirty:!0}))}}),{status:c,isUploading:l,activeUpload:o}=Ss(e),f=R(m=>m.abortUpload),x=R(m=>m.clearInactive);return s.jsxs("div",{children:[s.jsx(V,{className:"w-full",variant:"flat",color:"primary",startIcon:s.jsx(_t,{}),disabled:l,onClick:()=>i(),children:n("src")?s.jsx(d,{message:"Replace file"}):s.jsx(d,{message:"Upload file"})}),o&&s.jsx(Ht,{fileUpload:o,status:c,className:"mt-24",onAbort:m=>{f(m),x()}})]})}function $e({showExternalIdFields:e,showAlbumField:t=!0,uploadButton:a}){const{trans:n}=_(),r=te();return s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Xe,{name:"image",diskPrefix:"track_image",variant:r?"input":"square",label:r?s.jsx(d,{message:"Image"}):null,previewSize:r?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),s.jsx("div",{className:"mt-24",children:a||s.jsx(sr,{})})]}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),t&&s.jsx(zn,{className:"mb-24",label:s.jsx(d,{message:"Album"}),name:"album_id",endpoint:"search/suggestions/album"}),s.jsx(Ut,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:n(I("+Add genre")),model:Ns,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:n(I("+Add tag")),model:Et,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),s.jsx(nr,{}),e&&s.jsx(tr,{}),e&&s.jsx(ar,{})]})]})}function tr(){return s.jsx(M,{name:"src",label:s.jsx(d,{message:"Playback source"}),className:"mb-24",minLength:1,maxLength:230,description:s.jsx(d,{message:"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically."})})}function ar(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function nr(){const{watch:e}=Pe();return s.jsx(M,{required:!0,name:"duration",label:s.jsx(d,{message:"Duration (in milliseconds)"}),className:"mb-24",type:"number",min:1,max:864e5,description:s.jsx(d,{message:"Will appear on the site as: :preview",values:{preview:s.jsx(Wa,{ms:e("duration")})}})})}const Bt="tracks";function Kt(e,{onSuccess:t}={}){const{trans:a}=_();return ce({mutationFn:n=>rr(n),onSuccess:n=>{ee(a(I("Track created"))),de.invalidateQueries({queryKey:xe(Bt)}),t==null||t(n)},onError:n=>Ae(n,e)})}function rr(e){return L.post(Bt,As(e)).then(t=>t.data)}function As(e){var t;return{...e,album_id:e.album_id?e.album_id:null,artists:(t=e.artists)==null?void 0:t.map(a=>a.id)}}function Wt({onTrackCreated:e,defaultValues:t}={}){const a=re({defaultValues:t}),n=Kt(a,{onSuccess:e});return{form:a,createTrack:n}}function yi({wrapInContainer:e}){const t=Te(),{pathname:a}=ue(),{form:n,createTrack:r}=Wt({onTrackCreated:i=>{a.includes("admin")?t(`/admin/tracks/${i.track.id}/edit`):t(He(i.track))}});return s.jsx(Ve,{form:n,onSubmit:i=>{r.mutate(i)},title:s.jsx(d,{message:"Add new track"}),isLoading:r.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})})}const ir=e=>`tracks/${e}`;function lr(e,t={}){const{trans:a}=_();return ce({mutationFn:n=>or(n),onSuccess:n=>{var r;ee(a(I("Track updated"))),de.invalidateQueries({queryKey:xe("tracks")}),(r=t.onSuccess)==null||r.call(t,n)},onError:n=>Ae(n,e)})}function or({id:e,...t}){return L.put(ir(e),As(t)).then(a=>a.data)}function Gt(e,t={}){var r;const a=re({defaultValues:{...e,image:e.image||((r=e.album)==null?void 0:r.image)}}),n=lr(a,{onSuccess:t.onTrackUpdated});return{form:a,updateTrack:n}}function ki({wrapInContainer:e}){const t=yt({loader:"editTrackPage"});return t.data?s.jsx(cr,{track:t.data.track,wrapInContainer:e}):s.jsx(vs,{query:t,loaderClassName:"absolute inset-0 m-auto",loaderIsScreen:!1})}function cr({track:e,wrapInContainer:t}){const{canEdit:a}=Ga([e]),n=Te(),{pathname:r}=ue(),{form:i,updateTrack:c}=Gt(e,{onTrackUpdated:l=>{r.includes("admin")?n("/admin/tracks"):n(He(l.track))}});return a?s.jsx(Ve,{form:i,onSubmit:l=>{c.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}}),isLoading:c.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})}):s.jsx(ys,{to:"/",replace:!0})}const Qt="albums";function Zt(e){const{trans:t}=_();return ce({mutationFn:a=>dr(a),onSuccess:()=>{ee(t(I("Album created"))),de.invalidateQueries({queryKey:xe(Qt)})},onError:a=>Ae(a,e)})}function dr(e){return L.post(Qt,Jt(e)).then(t=>t.data)}function Jt(e){var t,a;return{...e,artists:(t=e.artists)==null?void 0:t.map(n=>n.id),tracks:(a=e.tracks)==null?void 0:a.map(n=>As(n))}}const ur=e=>`albums/${e}`;function mr(e,t){const{trans:a}=_(),n=Te(),{pathname:r}=ue();return ce({mutationFn:i=>xr(t,i),onSuccess:i=>{ee(a(I("Album updated"))),de.invalidateQueries({queryKey:xe("albums")}),r.includes("admin")?n("/admin/albums"):n(qe(i.album))},onError:i=>Ae(i,e)})}function xr(e,t){return L.put(ur(e),Jt(t)).then(a=>a.data)}function fr({track:e,hideAlbumField:t}){const{formId:a,close:n}=fs(),{form:r}=Gt(e);return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ks,{children:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ze,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Update"})})]})]})}function hr({defaultValues:e,hideAlbumField:t}){const{formId:a,close:n}=fs(),{form:r}=Wt({defaultValues:e});return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ks,{children:s.jsx(d,{message:"Add new track"})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Ze,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Create"})})]})]})}function pr(){const e=Pe(),{watch:t,setValue:a,getValues:n}=e,{fields:r,remove:i,prepend:c,move:l}=dt({name:"tracks"}),o=(m,p)=>{var g;const h=(g=n("tracks"))==null?void 0:g.findIndex(j=>j.uploadId===m);h!=null&&a(`tracks.${h}`,Ne(p,n(`tracks.${h}`)),{shouldDirty:!0})},{openFilePicker:f}=as({onUploadStart:m=>c(Ne(m,{artists:e.getValues("artists"),genres:e.getValues("genres"),tags:e.getValues("tags")})),onMetadataChange:(m,p)=>{qt(e,p),o(m.id,p)}}),x=t("tracks")||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"my-24 text-xl font-semibold",children:s.jsx(d,{message:"Tracks"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(_t,{}),onClick:()=>f(),children:s.jsx(d,{message:"Upload tracks"})}),s.jsxs(X,{type:"modal",onClose:m=>{m&&c(m)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Create track"}),children:s.jsx(q,{variant:"outline",color:"primary",size:"xs",children:s.jsx(Is,{})})}),s.jsx(hr,{hideAlbumField:!0,defaultValues:{artists:t("artists"),tags:t("tags"),genres:t("genres")}})]})]}),r.map((m,p)=>{const h=x[p];return s.jsx(gr,{track:h,onRemove:()=>i(p),onSort:(g,j)=>l(g,j),tracks:x,onUpdate:g=>{o(h.uploadId,g)}},m.id)}),r.length?null:s.jsx(ut,{className:"mt-40",image:s.jsx(mt,{src:Lt}),title:s.jsx(d,{message:"This album does not have any tracks yet"})})]})}function gr({track:e,tracks:t,onRemove:a,onUpdate:n,onSort:r}){const i=u.useRef(null),c=u.useRef(null),l=R(p=>p.abortUpload),o=R(p=>e.uploadId?p.fileUploads.get(e.uploadId):null),{isUploading:f,status:x}=Ss(e.uploadId),{sortableProps:m}=Za({disabled:f,ref:i,item:e,items:t,type:"albumFormTrack",preview:c,strategy:"line",onSortEnd:(p,h)=>{r(p,h)}});return s.jsxs("div",{className:"border-b border-t border-t-transparent py-4",ref:i,...m,children:[s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(q,{className:"mr-14 flex-shrink-0",disabled:f,children:s.jsx(Kn,{})}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),o&&s.jsxs("div",{className:"mr-10 flex items-center",children:[s.jsx(Ot,{fileUpload:o,status:x,className:"mr-10"}),s.jsx(js,{isIndeterminate:x==="processing",value:o.percentage,size:"sm"})]}),s.jsxs(X,{type:"modal",onClose:p=>{p&&n(p)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Edit track"}),children:s.jsx(q,{className:"ml-auto flex-shrink-0 text-muted",disabled:f,children:s.jsx(Ps,{})})}),s.jsx(fr,{track:e,hideAlbumField:!0})]}),s.jsxs(X,{type:"modal",onClose:p=>{p&&(e.uploadId&&l(e.uploadId),a())},children:[s.jsx(ke,{label:s.jsx(d,{message:"Remove track"}),children:s.jsx(q,{className:"flex-shrink-0 text-muted",children:s.jsx(bs,{})})}),s.jsx(xt,{isDanger:!0,title:s.jsx(d,{message:"Remove track"}),body:s.jsx(d,{message:"Are you sure you want to remove this track from the album?"}),confirm:s.jsx(d,{message:"Remove"})})]})]}),s.jsx(jr,{track:e,ref:c})]})}const jr=We.forwardRef(({track:e},t)=>{var n,r;let a=e.name;return(n=e.artists)!=null&&n.length&&(a+=`- ${(r=e.artists)==null?void 0:r[0].name}`),s.jsx(Qa,{ref:t,children:()=>s.jsx("div",{className:"rounded bg-chip p-8 text-sm shadow",children:a})})});function Ts({showExternalIdFields:e}){const{trans:t}=_(),a=te();return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Xe,{name:"image",diskPrefix:"album_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:"md:w-full md:w-224 md:aspect-square",stretchPreview:!0})}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),s.jsx(qn,{name:"release_date",label:s.jsx(d,{message:"Release date"}),className:"mb-24",granularity:"day"}),s.jsx(Ut,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:Ns,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:t(I("+Add tag")),model:Et,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),e&&s.jsx(br,{})]})]}),s.jsx(pr,{})]})}function br(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function wi({wrapInContainer:e}){const t=kt({loader:"editAlbumPage"});return t.data?s.jsx(me,{children:s.jsx(vr,{album:t.data.album,wrapInContainer:e})}):s.jsx(vs,{query:t,loaderIsScreen:!1,loaderClassName:"absolute inset-0 m-auto"})}function vr({album:e,wrapInContainer:t}){const{canEdit:a}=Ja(e),n=!!R(c=>c.activeUploadsCount),r=re({defaultValues:{image:e.image,name:e.name,release_date:e.release_date,artists:e.artists,genres:e.genres,tags:e.tags,description:e.description,spotify_id:e.spotify_id,tracks:e.tracks}}),i=mr(r,e.id);return a?s.jsx(Ve,{form:r,onSubmit:c=>{i.mutate(c)},title:s.jsx(d,{message:"Edit “:name“ album",values:{name:e.name}}),isLoading:i.isPending||n,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Ts,{showExternalIdFields:!0})}):s.jsx(ys,{to:"/",replace:!0})}const yr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=wt(),i=Fe(),[c,l]=u.useState(!1),o=re({defaultValues:{tracks:[],artists:r?[r]:[],release_date:i.toAbsoluteString()}}),f=o.watch("tracks")||[],x=R(y=>y.abortUpload),m=!!R(y=>y.activeUploadsCount),{openFilePicker:p,uploadTracks:h,validateUploads:g}=as({onUploadStart:y=>{l(!0),o.setValue("tracks",[...o.getValues("tracks"),y]),e()},onMetadataChange:(y,k)=>{qt(o,k),o.setValue("tracks",o.getValues("tracks").map(w=>w.uploadId===y.id?Ne(k,w):w))}});u.useImperativeHandle(n,()=>({openFilePicker:p,uploadTracks:h,validateUploads:g}),[p,h,g]);const j=Zt(o);return c?s.jsxs(Se,{className:"mb-30 rounded border bg-paper p-14 md:p-24",form:o,onSubmit:y=>j.mutate(y,{onSuccess:k=>{l(!1),o.reset(),a(k.album)}}),children:[s.jsx(Ts,{showExternalIdFields:!1}),s.jsxs("div",{className:"mt-24",children:[s.jsx(V,{variant:"text",onClick:()=>{f.forEach(y=>{x(y.uploadId)}),o.reset(),l(!1),t()},className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:m||j.isPending,children:s.jsx(d,{message:"Save"})})]})]}):null}),kr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=wt(),i=R(m=>m.abortUpload),[c,l]=u.useState([]),{openFilePicker:o,uploadTracks:f,validateUploads:x}=as({onUploadStart:m=>{l(p=>r?[...p,{...m,artists:[r]}]:[...p,m]),e()},onMetadataChange:(m,p)=>{l(h=>h.map(g=>g.uploadId===m.id?Ne(p,g):g))}});return u.useImperativeHandle(n,()=>({openFilePicker:o,uploadTracks:f,validateUploads:x}),[o,f,x]),s.jsx("div",{className:"w-full",children:c.map(m=>s.jsx(wr,{track:m,onCreate:p=>{l(h=>h.filter(g=>g.uploadId!==m.uploadId)),a(p)},onRemove:()=>{l(p=>{const h=p.filter(g=>g.uploadId!==m.uploadId);return h.length||t(),h}),i(m.uploadId)}},m.uploadId))})}),wr=u.memo(({track:e,onRemove:t,onCreate:a})=>{const n=re({defaultValues:e}),r=Kt(n),i=R(f=>f.fileUploads.get(e.uploadId)),{isUploading:c,status:l}=Ss(e.uploadId);u.useEffect(()=>{n.reset(e)},[e,n]);const o=c&&i?s.jsx(Ht,{fileUpload:i,status:l}):null;return s.jsxs(Se,{form:n,onSubmit:f=>{r.mutate(f,{onSuccess:x=>a(x.track)})},className:"mb-30 rounded border bg-paper p-14 md:p-24",children:[s.jsx($e,{uploadButton:o,showExternalIdFields:!1}),s.jsx(V,{variant:"text",onClick:()=>t(),className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:r.isPending||!n.watch("src"),children:s.jsx(d,{message:"Save"})})]})}),Nr=""+new URL("album-border-b5dd7d9f.png",import.meta.url).href;function Ir({media:e}){var n,r;const t=e.model_type===Ya,a=t?qe(e,{absolute:!0}):He(e,{absolute:!0});return s.jsxs("div",{className:"mx-auto my-20 flex w-780 max-w-full items-center gap-28 rounded border bg-paper p-20",children:[s.jsxs("div",{className:S(t&&"relative isolate mx-18 my-14"),children:[t?s.jsx(ss,{album:e,className:"relative z-20 flex-shrink-0 rounded",size:"w-132 h-132"}):s.jsx(Cs,{track:e,className:"relative z-20 flex-shrink-0 rounded",size:"w-132 h-132"}),t&&s.jsx("img",{className:"absolute -left-14 -top-14 z-10 block h-160 w-160 max-w-160",src:Nr,alt:""})]}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:"text-base font-bold",children:e.name}),s.jsx("div",{className:"mb-14 text-sm text-muted",children:s.jsx(ts,{artists:e.artists})}),(n=e.genres)!=null&&n.length?s.jsx(vt,{selectable:!1,size:"sm",className:"mb-14",children:(r=e.genres)==null?void 0:r.map(i=>s.jsx(ct,{children:i.display_name||i.name},i.id))}):null,s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Upload complete. <a>Go to your track</a>",values:{a:i=>s.jsx(Z,{className:ft,to:t?qe(e):He(e),children:i})}})})]}),s.jsx("div",{className:"max-w-300 ml-auto flex-auto",children:s.jsxs("div",{className:"text-sm text-muted",children:[s.jsx(d,{message:"Share your new track"}),s.jsx(Xa,{name:e.name,image:e.image,link:a}),s.jsx(Fa,{value:a,readOnly:!0,className:"mt-24 w-full",size:"sm",onClick:i=>{i.target.select()}})]})})]})}function Cr({isVisible:e}){const t=s.jsx(Y.div,{...gs,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:s.jsx(Y.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:s.jsx(d,{message:"Drop your files anywhere on the page to upload"})})},"dragTargetMask");return s.jsx(Je,{children:e?t:null})}function Dr(){const{user:e}=je();e!=null&&e.id&&de.resetQueries({queryKey:["minutesLimit",e.id]})}function Pr(){const{user:e}=Va(),t=e==null?void 0:e.id;return ne({queryKey:["minutesLimit",t],queryFn:()=>Sr(t),enabled:t!=null})}function Sr(e){return L.get(`users/${e}/minutes-left`).then(t=>t.data)}const Ar=""+new URL("light-bg-8c37cb47.svg",import.meta.url).href,Tr=""+new URL("dark-bg-38ecc414.svg",import.meta.url).href;function Fr({children:e,...t}){const a=$a();return s.jsxs("div",{className:"flex h-screen flex-col",...t,children:[s.jsx(ht,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"relative flex-auto overflow-y-auto bg-cover",style:{backgroundImage:`url(${a?Tr:Ar})`},children:s.jsxs("div",{className:"container mx-auto flex min-h-full flex-col p-14 md:p-24",children:[s.jsx("div",{className:"flex-auto",children:e}),s.jsx(pt,{})]})})]})}function Ni({backstageLayout:e=!0}){return s.jsx(me,{children:s.jsx(Vr,{backstageLayout:e})})}function Vr({backstageLayout:e}){const[t,a]=u.useState("tracks"),[n,r]=u.useState(!1),i=u.useRef(null),c=t==="tracks"?kr:yr,[l,o]=u.useState([]),f=u.useRef(null),[x,m]=u.useState(!1),{droppableProps:p}=en({id:"uploadPageRoot",ref:f,types:["nativeFile"],onDragEnter:()=>m(!0),onDragLeave:()=>m(!1),onDrop:async g=>{var j,y;if(g.type==="nativeFile"){const k=await g.getData(),w=(j=i.current)==null?void 0:j.validateUploads(k);w!=null&&w.length&&((y=i.current)==null||y.uploadTracks(w))}}}),h=e?Fr:Rr;return s.jsxs(h,{...p,children:[!n&&s.jsx($r,{onUpload:()=>{var g;return(g=i.current)==null?void 0:g.openFilePicker()},uploadMode:t,onUploadModeChange:a}),l.map(g=>s.jsx(Ir,{media:g},g.id)),s.jsx(c,{ref:i,onUploadStart:()=>r(!0),onCreate:g=>{o(j=>[...j,g]),Dr()},onCancel:()=>{r(!1)}}),s.jsx(Cr,{isVisible:x})]})}function $r({onUpload:e,uploadMode:t,onUploadModeChange:a}){const{data:n}=Pr();return s.jsxs("div",{className:"pt-40",children:[s.jsxs("div",{className:"mx-auto flex max-w-580 flex-col items-center rounded border bg-paper p-20 md:p-48",children:[s.jsx("h1",{className:"text-base md:text-[22px] md:font-light",children:s.jsx(d,{message:"Drag and drop your tracks, videos & albums here."})}),s.jsx(V,{variant:"flat",color:"primary",className:"mt-20 w-min",onClick:()=>e(),children:s.jsx(d,{message:"Or choose files to upload"})}),s.jsx("div",{className:"mt-20 border-t pt-20",children:s.jsx(bt,{checked:t==="album",onChange:r=>a(r.target.checked?"album":"tracks"),children:s.jsx(d,{message:"Make an album when multiple files are selected"})})})]}),s.jsx("div",{className:"mt-20 min-h-20 text-center text-sm text-muted",children:(n==null?void 0:n.minutesLeft)!=null&&s.jsx(d,{message:"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.",values:{count:n.minutesLeft,a:r=>s.jsx(Z,{className:ft,to:"/pricing",children:r})}})})]})}function Rr({children:e,...t}){return s.jsx("div",{...t,className:"relative min-h-full",children:s.jsx("div",{className:"container mx-auto p-14 md:p-24",children:e})})}function Ii({wrapInContainer:e}){return s.jsx(me,{children:s.jsx(zr,{wrapInContainer:e})})}function zr({wrapInContainer:e}){const t=!!R(x=>x.activeUploadsCount),a=Fe(),n=Te(),{pathname:r}=ue(),[i]=Ra(),{data:c}=zt(`normalized-models/artist/${i.get("artistId")}`,void 0,{enabled:!!i.get("artistId")}),l=c==null?void 0:c.model,o=re({defaultValues:{release_date:a.toAbsoluteString()}}),f=Zt(o);return u.useEffect(()=>{l&&o.reset({artists:[l]})},[l,o]),s.jsx(Ve,{form:o,onSubmit:x=>{f.mutate(x,{onSuccess:m=>{r.includes("admin")?n(l?`/admin/artists/${l.id}/edit`:"/admin/albums"):n(qe(m.album))}})},title:s.jsx(d,{message:"Add new album"}),isLoading:f.isPending||t,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(Ts,{showExternalIdFields:!0})})}function Ci(){const{requestId:e}=es();return ne({queryKey:["backstage-request",+e],queryFn:()=>Mr(e)})}function Mr(e){return L.get(`backstage-request/${e}`).then(t=>t.data)}const Di=G(s.jsx("path",{d:"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z"}),"DocumentScannerOutlined"),Yt=G(s.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger"),Lr=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3",body:e=>s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx(ss,{album:e,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),s.jsx(Ds,{album:e,target:"_blank"})]})},{key:"release_date",allowsSorting:!0,header:()=>s.jsx(d,{message:"Release date"}),body:e=>e.release_date?s.jsx(za,{date:e.release_date}):null},{key:"track_count",allowsSorting:!1,header:()=>s.jsx(d,{message:"Track count"}),body:e=>e.tracks_count?s.jsx(Be,{value:e.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>s.jsx(d,{message:"Plays"}),body:e=>e.plays?s.jsx(Be,{value:e.plays}):null},{key:"actions",header:()=>s.jsx(d,{message:"Actions"}),width:"w-84 flex-shrink-0",visibleInMode:"all",hideHeader:!0,align:"end",body:e=>s.jsx(Er,{album:e})}];function Ur({albums:e=[]}){const{watch:t}=Pe(),a=t("id"),{data:n,sortDescriptor:r,onSortChange:i}=sn(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"my-24",children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold",children:s.jsx(d,{message:"Albums"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Is,{}),elementType:a?Z:void 0,to:`../../../albums/new?artistId=${a}`,relative:"path",disabled:!a,children:s.jsx(d,{message:"Add album"})})]}),!a&&s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsx(Yt,{viewBox:"0 0 16 16",size:"xs",className:"text-muted"}),s.jsx(d,{message:"Save changes to enable album creation."})]})]}),s.jsx(tn,{columns:Lr,data:e,sortDescriptor:r,onSortChange:i,enableSelection:!1}),n.length?null:s.jsx(ut,{className:"mt-40",image:s.jsx(mt,{src:Lt}),title:s.jsx(d,{message:"This artist does not have any albums yet"})})]})}function Er({album:e}){const t=an();return s.jsxs("div",{className:"text-muted",children:[s.jsx(Z,{to:`../../../albums/${e.id}/edit`,relative:"path",children:s.jsx(q,{size:"md",children:s.jsx(Ps,{})})}),s.jsxs(X,{type:"modal",onClose:a=>{a&&t.mutate({albumId:e.id})},children:[s.jsx(q,{size:"md",disabled:t.isPending,children:s.jsx(bs,{})}),s.jsx(xt,{isDanger:!0,title:s.jsx(d,{message:"Delete album"}),body:s.jsx(d,{message:"Are you sure you want to delete this album?"}),confirm:s.jsx(d,{message:"Delete"})})]})]})}function _r({albums:e,showExternalFields:t}){const a=te();return s.jsxs(me,{children:[s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Xe,{name:"image_small",diskPrefix:"artist_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),t&&s.jsx(nn,{name:"verified",className:"mt-14",children:s.jsx(d,{message:"Verified"})})]}),s.jsx("div",{className:"mt-24 flex-auto md:mt-0",children:s.jsxs(rn,{isLazy:!0,children:[s.jsxs(ln,{children:[s.jsx(Re,{children:s.jsx(d,{message:"Details"})}),s.jsx(Re,{children:s.jsx(d,{message:"Links"})}),s.jsx(Re,{children:s.jsx(d,{message:"Biography"})}),s.jsx(Re,{children:s.jsx(d,{message:"Images"})})]}),s.jsxs(on,{className:"pt-20",children:[s.jsx(ze,{children:s.jsx(Or,{showExternalFields:t})}),s.jsx(ze,{children:s.jsx(cn,{})}),s.jsx(ze,{children:s.jsx(Hr,{})}),s.jsx(ze,{children:s.jsx(qr,{})})]})]})})]}),s.jsx(Ur,{albums:e})]})}function Or({showExternalFields:e}){const{trans:t}=_();return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0,disabled:!e}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:Ns,name:"genres",allowCustomValue:!0,className:"mb-24"}),e&&s.jsx(Br,{})]})}function Hr(){return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"profile.country",label:s.jsx(d,{message:"Country"}),className:"mb-24"}),s.jsx(M,{name:"profile.city",label:s.jsx(d,{message:"City"}),className:"mb-24"}),s.jsx(M,{inputElementType:"textarea",rows:5,name:"profile.description",label:s.jsx(d,{message:"Description"}),className:"mb-24"})]})}function qr(){const{fields:e,append:t,remove:a}=dt({name:"profile_images"});return s.jsxs("div",{children:[s.jsx("div",{className:"mb-24 flex flex-wrap gap-12",children:e.map((n,r)=>s.jsx(Xe,{name:`profile_images.${r}.url`,diskPrefix:"artist_images",variant:"square",previewSize:"w-160 h-160",stretchPreview:!0,showRemoveButton:!0,onChange:i=>{i||a(r)}},n.id))}),s.jsx(V,{variant:"outline",color:"primary",startIcon:s.jsx(Is,{}),onClick:()=>{t({url:""})},children:s.jsx(d,{message:"Add another image"})})]})}function Br(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}const Kr=e=>`artists/${e}`;function Wr(e){const{trans:t}=_(),a=Te(),{pathname:n}=ue();return ce({mutationFn:r=>Gr(r),onSuccess:r=>{ee(t(I("Artist updated"))),de.invalidateQueries({queryKey:xe("artists")}),n.includes("admin")?a("/admin/artists"):a(Ma(r.artist))},onError:r=>Ae(r,e)})}function Gr({id:e,...t}){return L.put(Kr(e),t).then(a=>a.data)}function Pi({wrapInContainer:e,showExternalFields:t}){const a=Nt({loader:"editArtistPage"});return a.data?s.jsx(Qr,{response:a.data,wrapInContainer:e,showExternalFields:t}):s.jsx(vs,{query:a,loaderClassName:"absolute inset-0 m-auto"})}function Qr({response:e,wrapInContainer:t,showExternalFields:a}){var c;const{canEdit:n}=dn(e.artist),r=re({defaultValues:{id:e.artist.id,name:e.artist.name,verified:e.artist.verified,spotify_id:e.artist.spotify_id,genres:e.artist.genres,image_small:e.artist.image_small,links:e.artist.links,profile:e.artist.profile,profile_images:e.artist.profile_images}}),i=Wr(r);return n?s.jsx(Ve,{form:r,onSubmit:l=>{i.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ artist",values:{name:e.artist.name}}),isLoading:i.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(_r,{albums:(c=e.albums)==null?void 0:c.data,showExternalFields:a})}):s.jsx(ys,{to:"/",replace:!0})}const Zr={month:"short",day:"2-digit"};function Jr({value:e,onChange:t,disabled:a,compactOnMobile:n=!0,enableCompare:r=!1,granularity:i="minute"}){const c=te();return s.jsxs(X,{type:"popover",onClose:l=>{l&&t(l)},children:[s.jsx(V,{variant:"outline",color:"chip",endIcon:s.jsx(Pt,{}),disabled:a,children:s.jsx(Vt,{start:e.start,end:e.end,options:c&&n?Zr:rt.short})}),s.jsx(Yr,{value:e,enableCompare:r,granularity:i})]})}function Yr({value:e,enableCompare:t,granularity:a}){const n=te(),r=Hs({granularity:a,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,c=Hs({granularity:a,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:$t[0].getRangeValue(r.selectedValue)});return s.jsx(Pn,{state:r,compareState:t?c:void 0,compareVisibleDefault:i,showInlineDatePickerField:!n})}function Fs(e){const{title:t,description:a,children:n,className:r,contentIsFlex:i=!0,contentClassName:c,contentRef:l,minHeight:o="min-h-440"}=e;return s.jsxs("div",{className:S("flex h-full flex-auto flex-col rounded-panel border bg dark:bg-alt",o,r),children:[s.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[s.jsx("div",{className:"text-sm font-semibold",children:t}),a&&s.jsx("div",{className:"text-muted",children:a})]}),s.jsx("div",{ref:l,className:S("relative p-14",i&&"flex flex-auto items-center justify-center",c),children:n})]})}function Ke(){return s.jsxs("div",{className:"absolute mx-auto flex items-center gap-10 text-sm",children:[s.jsx(js,{isIndeterminate:!0,size:"sm"}),s.jsx(d,{message:"Chart loading"})]})}const Xr=u.lazy(()=>La(()=>import("./lazy-chart-d9b93650.js"),["./lazy-chart-d9b93650.js","./main-7e78f4ad.js","./main-1261cc47.css"],import.meta.url));function Xt(e){const{title:t,description:a,className:n,contentRef:r,isLoading:i}=e;return s.jsx(Fs,{title:t,description:a,className:n,contentRef:r,children:s.jsxs(u.Suspense,{fallback:s.jsx(Ke,{}),children:[s.jsx(Xr,{...e}),i&&s.jsx(Ke,{})]})})}function ea(e,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const c=r.data.map((l,o)=>{let f;return i===0||!a?(f=ei(l,e.granularity,t),n[o]=f):f=n[o],{...f,value:l.value}});return{...r,data:c}})}}function ei(e,t,a){return e.label?{label:e.label}:e.date?si(e,t,a):{label:""}}function si({date:e,endDate:t},a="day",n){const r=Oe(e).toDate(),i=t?Oe(t).toDate():null;switch(a){case"minute":return{label:E(n,{second:"2-digit"}).format(r),tooltipTitle:E(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:E(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:E(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:E(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:E(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:E(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:E(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,i)};case"month":return{label:E(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:E(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:E(n,{year:"numeric"}).format(r),tooltipTitle:E(n,{year:"numeric"}).format(r)}}}const E=Ua((e,t)=>new Ea(e,t),{equals:(e,t)=>it(e,t),callTimeout:void 0}),Qs=je().themes.all[0].values["--be-primary"],ge=[[`rgb(${Qs.replaceAll(" ",",")})`,`rgba(${Qs.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],ti={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function ai({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{const i=ea(e,{localeCode:n});return i.datasets=i.datasets.map((c,l)=>({...c,backgroundColor:ge[l][1],borderColor:ge[l][0],pointBackgroundColor:ge[l][0]})),i},[e,n]);return s.jsx(Xt,{...a,className:S(t,"min-w-500"),data:r,type:"line",options:ti})}const ni={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Zs({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{var c;const i=ea(e,{localeCode:n});return i.labels=(c=i.datasets[0])==null?void 0:c.data.map(l=>l.label),i.datasets=i.datasets.map((l,o)=>({...l,backgroundColor:ge.map(f=>f[1]),borderColor:ge.map(f=>f[0]),borderWidth:2})),i},[e,n]);return s.jsx(Xt,{type:"polarArea",data:r,options:ni,className:S(t,"min-w-500"),...a})}const Js="https://www.gstatic.com/charts/loader.js";function ri({placeholderRef:e,data:t,country:a,onCountrySelected:n}){const{trans:r}=_(),{analytics:i}=oe(),c=i==null?void 0:i.gchart_api_key,{selectedTheme:l}=_a(),o=u.useRef(),f=!!n&&!a,x=u.useCallback(()=>{var y,k;if(typeof google>"u")return;const p=t.map(w=>[w.label,w.value]);p.unshift([r(a?I("City"):I("Country")),r(I("Clicks"))]);const h=`${Os(l.values["--be-paper"])}`,j={colorAxis:{colors:[`${Os(l.values["--be-primary"])}`]},backgroundColor:h,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:f};!o.current&&e.current&&((y=google==null?void 0:google.visualization)!=null&&y.GeoChart)&&(o.current=new google.visualization.GeoChart(e.current)),(k=o.current)==null||k.draw(google.visualization.arrayToDataTable(p),j)},[l,t,e,r,a,f]),m=u.useCallback(async()=>{_s.isLoadingOrLoaded(Js)||(await _s.loadAsset(Js,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:c}),x())},[c,x]);return u.useEffect(()=>(o.current&&n&&google.visualization.events.addListener(o.current,"regionClick",p=>n==null?void 0:n(p.region)),()=>{o.current&&google.visualization.events.removeAllListeners(o.current)}),[n,o.current]),u.useEffect(()=>{m()},[m]),u.useEffect(()=>{x()},[l,x,t]),{drawGoogleChart:x}}const ii=G(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined");function li({title:e,body:t,dialogSize:a="sm",className:n}){return s.jsxs(X,{type:"popover",triggerOnHover:!0,children:[s.jsx(q,{className:S("ml-4 text-muted opacity-70",n),iconSize:"xs",size:"2xs",children:s.jsx(Yt,{viewBox:"0 0 16 16"})}),s.jsxs(Ce,{size:a,children:[e&&s.jsx(ks,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),s.jsx(De,{children:t})]})]})}const oi=u.memo(({code:e})=>{const{localeCode:t}=ae(),a=new Intl.DisplayNames([t],{type:"region"});let n;try{n=a.of(e.toUpperCase())}catch{}return s.jsx(u.Fragment,{children:n})});function ci({data:e,isLoading:t,onCountrySelected:a,country:n,...r}){const i=u.useRef(null),c=!!a,l=e==null?void 0:e.datasets[0].data,o=u.useMemo(()=>l||[],[l]);return ri({placeholderRef:i,data:o,country:n,onCountrySelected:a}),s.jsxs(Fs,{...r,className:"min-w-500",title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{message:"Top Locations"}),n?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(oi,{code:n}),")"]}):null,c&&s.jsx(di,{})]}),contentIsFlex:t,children:[t&&s.jsx(Ke,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:i,className:"min-h-[340px] w-[480px] flex-auto"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"max-h-[340px] w-full flex-initial overflow-y-auto text-sm",children:o.map(f=>s.jsxs("div",{className:S("mb-4 flex items-center gap-4",c&&"cursor-pointer hover:underline"),role:c?"button":void 0,onClick:()=>{a==null||a(f.code)},children:[s.jsx("div",{className:"max-w-110 overflow-hidden overflow-ellipsis whitespace-nowrap",children:f.label}),s.jsxs("div",{children:["(",f.percentage,")%"]})]},f.label))}),n&&s.jsx(V,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(ii,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(d,{message:"Back to countries"})})]})]})]})}function di(){return s.jsx(li,{title:s.jsx(d,{message:"Zooming in"}),body:s.jsx(d,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const Ys="reports/insights";function ui(e,t){return ne({queryKey:[Ys,e],queryFn:()=>mi(Ys,e),placeholderData:t.isEnabled?Ye:void 0,enabled:t.isEnabled})}function mi(e,t){var n;const a={model:t.model,metrics:(n=t.metrics)==null?void 0:n.join(",")};return a.startDate=t.dateRange.start.toAbsoluteString(),a.endDate=t.dateRange.end.toAbsoluteString(),a.timezone=t.dateRange.start.timeZone,L.get(e,{params:a}).then(r=>r.data)}const xi=G(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");function Le({data:e,isLoading:t,...a}){const n=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(Fs,{...a,className:"w-1/2 min-w-500 md:min-w-0",contentIsFlex:t,contentClassName:"max-h-[370px] overflow-y-auto compact-scrollbar",children:[t&&s.jsx(Ke,{}),n.map(r=>s.jsxs("div",{className:"mb-20 flex items-center justify-between gap-24 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(fi,{model:r.model,size:"w-42 h-42",className:"flex-shrink-0 rounded"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(hi,{model:r.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(pi,{model:r.model})})]})]}),s.jsxs("div",{className:"flex flex-shrink-0 items-center gap-4",children:[s.jsx(un,{className:"text-muted",size:"sm"}),s.jsx(d,{message:":count plays",values:{count:s.jsx(Be,{value:r.value})}})]})]},r.model.id)),!t&&!n.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(xi,{size:"sm"}),s.jsx(d,{message:"No plays in selected timeframe."})]}):null]})}function fi({model:e,size:t,className:a}){const{pathname:n}=ue(),i=n.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(Z,{to:i,children:s.jsx(gt,{artist:e,size:t,className:a})});case"album":return s.jsx(Z,{to:i,children:s.jsx(ss,{album:e,size:t,className:a})});case"track":return s.jsx(Z,{to:i,children:s.jsx(Cs,{track:e,size:t,className:a})});case"user":return s.jsx(mn,{user:e,size:t,className:a})}}function hi({model:e}){switch(e.model_type){case"artist":return s.jsx(jt,{artist:e,target:"_blank"});case"album":return s.jsx(Ds,{album:e,target:"_blank"});case"track":return s.jsx(It,{track:e,target:"_blank"});case"user":return e.id?s.jsx(Oa,{user:e,target:"_blank"}):s.jsx(u.Fragment,{children:e.display_name})}}function pi({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(ts,{artists:e.artists,target:"_blank"})}}function Vs(e){const a="flex flex-col lg:flex-row lg:items-center overflow-x-auto gap-12 md:gap-24 mb-12 md:mb-24",n=e.model,r=e.dateRange;return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"plays",model:n,dateRange:r,children:({data:i})=>s.jsx(ai,{className:"flex-auto",title:s.jsx(d,{message:"Plays"}),hideLegend:!0,description:s.jsx(d,{message:":count total plays",values:{count:s.jsx(Be,{value:(i==null?void 0:i.report.plays.total)||0})}})})}),s.jsx(W,{metric:"devices",model:n,dateRange:r,children:s.jsx(Zs,{title:s.jsx(d,{message:"Top devices"})})})]}),s.jsxs("div",{className:a,children:[e.showTracks&&s.jsx(W,{metric:"tracks",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played tracks"})})}),s.jsx(W,{metric:"users",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Top listeners"})})})]}),e.showArtistsAndAlbums&&s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"artists",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played artists"})})}),s.jsx(W,{metric:"albums",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played albums"})})})]}),s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"locations",model:n,dateRange:r,children:s.jsx(ci,{className:"w-1/2 flex-auto lg:max-w-[740px]"})}),s.jsx(W,{metric:"platforms",model:n,dateRange:r,children:s.jsx(Zs,{className:"max-w-500",title:s.jsx(d,{message:"Top platforms"})})})]})]})}function W({children:e,metric:t,model:a,dateRange:n}){var x,m;const[r,i]=u.useState(!1),c=ui({metrics:[t],model:a,dateRange:n},{isEnabled:r}),l=typeof e=="function"?e(c):e,o=u.useRef(),f=u.useCallback(p=>{var h;if(p){const g=new IntersectionObserver(([j])=>{var y;j.isIntersecting&&(i(!0),(y=o.current)==null||y.disconnect(),o.current=void 0)},{threshold:.1});o.current=g,g.observe(p)}else o.current&&((h=o.current)==null||h.disconnect())},[]);return u.cloneElement(l,{data:(m=(x=c.data)==null?void 0:x.report)==null?void 0:m[t],isLoading:c.isLoading,contentRef:f})}function $s({children:e,reportModel:t,title:a,isNested:n}){const[r,i]=u.useState(()=>Dt[2].getRangeValue());return s.jsxs(u.Fragment,{children:[s.jsx(Ha,{children:s.jsx(d,{message:"Insights"})}),s.jsxs("div",{className:"flex h-full flex-col",children:[!n&&s.jsx(ht,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"relative flex-auto overflow-y-auto bg-cover",children:s.jsxs("div",{className:"mx-auto flex min-h-full max-w-[1600px] flex-col overflow-x-hidden p-12 md:p-24",children:[s.jsxs("div",{className:"flex-auto",children:[s.jsxs("div",{className:"mb-38 mt-14 h-48 items-center justify-between gap-24 md:flex",children:[a||s.jsx(pe,{className:"max-w-320"}),s.jsx("div",{className:"flex flex-shrink-0 items-center justify-between gap-10 md:gap-24",children:s.jsx(Jr,{value:r,onChange:i})})]}),u.cloneElement(e,{dateRange:r,model:t})]}),!n&&s.jsx(pt,{})]})})]})]})}function Rs({image:e,name:t,description:a}){return s.jsxs("div",{className:"flex items-center gap-10",children:[u.cloneElement(e,{size:"w-48 h-48",className:"rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-base",children:["“",t,"“ ",s.jsx(d,{message:"insights"})]}),a&&s.jsx("div",{className:"text-sm text-muted",children:a})]})]})}function Si({isNested:e}){const{artistId:t}=es(),{data:a}=Nt({loader:"artist"});return s.jsx($s,{reportModel:`artist=${t}`,title:(a==null?void 0:a.artist)&&s.jsx(Rs,{image:s.jsx(gt,{artist:a.artist}),name:s.jsx(jt,{artist:a.artist})}),isNested:e,children:s.jsx(Vs,{showTracks:!0})})}function Ai({isNested:e}){const{albumId:t}=es(),{data:a}=kt({loader:"album"});return s.jsx($s,{reportModel:`album=${t}`,title:(a==null?void 0:a.album)&&s.jsx(Rs,{image:s.jsx(ss,{album:a.album}),name:s.jsx(Ds,{album:a.album}),description:s.jsx(ts,{artists:a.album.artists})}),isNested:e,children:s.jsx(Vs,{showTracks:!0})})}function Ti({isNested:e}){const{trackId:t}=es(),{data:a}=yt({loader:"track"});return s.jsx($s,{reportModel:`track=${t}`,title:(a==null?void 0:a.track)&&s.jsx(Rs,{image:s.jsx(Cs,{track:a.track}),name:s.jsx(It,{track:a.track}),description:s.jsx(ts,{artists:a.track.artists})}),isNested:e,children:s.jsx(Vs,{})})}export{pn as A,Xt as B,_n as C,Pn as D,Ai as E,zn as F,ci as G,Pi as H,Vs as I,Si as J,Ni as K,ai as L,Wn as M,ii as N,xi as O,Zs as P,Fr as Q,Jr as R,_t as S,ki as U,At as a,Pt as b,ds as c,Dt as d,Mt as e,Vt as f,zt as g,vi as h,xe as i,qn as j,Kn as k,Fe as l,Ve as m,Rt as n,Lt as o,Ci as p,Di as q,_r as r,ea as s,ge as t,Hs as u,li as v,yi as w,Ti as x,Ii as y,wi as z};
//# sourceMappingURL=backstage-track-insights-e92e3db3.js.map

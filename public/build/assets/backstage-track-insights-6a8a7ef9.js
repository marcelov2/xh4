import{aE as je,c1 as ea,c2 as Xs,m as I,c3 as Ee,c4 as sa,c5 as be,c6 as ve,c7 as Rs,c8 as zs,a as G,j as s,R as Ke,c as S,i as ta,aj as us,aO as et,aP as st,aQ as tt,$ as Ie,c9 as aa,ca as na,cb as ms,r as u,cc as Y,h as We,cd as as,ce as ns,cf as he,cg as ye,ch as at,b as te,b6 as ae,k as Ge,ci as J,cj as ra,ck as ia,cl as la,cm as oa,cn as ca,co as da,cp as ua,l as X,I as q,u as oe,aK as nt,cq as rt,cr as ma,ab as it,ac as lt,T as d,p as xs,G as Qe,B as V,q as Ce,v as De,A as Ze,an as ne,b7 as Ye,X as L,af as Pe,d as fs,n as _,S as xa,g as hs,L as ps,a5 as ke,H as pe,a2 as ot,cs as fa,bV as ha,ct as pa,cu as ga,at as gs,K as ja,cv as ba,c0 as va,e as _e,D as ee,x as Se,aM as Ms,P as ya,cw as R,ap as ka,cx as wa,bb as Na,cy as Ia,J as js,Q as ce,W as Ca,bd as Ls,be as Da,V as se,cz as Pa,cA as Sa,a8 as Je,o as M,U as de,a0 as Ae,w as re,ax as Te,ao as ue,as as me,b1 as bs,ar as vs,t as ys,a7 as ct,Z as dt,_ as ut,Y as mt,a3 as Z,aC as xt,z as Aa,bx as Ta,bw as Fa,N as ft,cB as ht,bT as Va,aw as Xe,a4 as $a,bA as Ra,ae as za,aL as Ma,cC as La,bH as Ua,bI as Us,a$ as pt,b4 as Ea,b0 as gt,M as _a}from"./main-0b7be7a7.js";import{K as Oa,a as Ha,_ as qa,S as jt,A as ks,C as bt,a1 as Ba,G as ws,l as Ka,w as Oe,Y as vt,H as Wa,x as He,D as Ga,b as Ns,u as Qa,X as yt,z as Za,M as kt,p as Ya,n as es,j as Is,B as ss,v as Ja,a2 as Xa,Q as en,T as sn,o as Cs,F as qe,E as tn,c as an,e as nn,f as rn,g as Re,h as ln,i as ze,Z as on,V as wt,y as cn,t as Es,P as dn,U as un,k as Nt}from"./play-arrow-filled-61b607f8.js";import{E as Ds}from"./Edit-554396de.js";function It(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}function H(e){return e.set({hour:24-1,minute:60-1,second:60-1,millisecond:1e3-1})}function mn(){var a,n,r;const e=(a=je())==null?void 0:a.settings.dates.default_timezone,t=((r=(n=je())==null?void 0:n.user)==null?void 0:r.timezone)||e||"auto";return!t||t==="auto"?ea():t}const F=It(Xs(mn()));var Ys,Js;const rs=((Js=(Ys=je())==null?void 0:Ys.i18n)==null?void 0:Js.language)||"en",Ct=[{key:0,label:I("Today"),getRangeValue:()=>({preset:0,start:F,end:H(F)})},{key:1,label:I("Yesterday"),getRangeValue:()=>({preset:1,start:F.subtract({days:1}),end:H(F).subtract({days:1})})},{key:2,label:I("This week"),getRangeValue:()=>({preset:2,start:Ee(F,rs),end:sa(H(F),rs)})},{key:3,label:I("Last week"),getRangeValue:()=>{const e=Ee(F,rs).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:I("Last 7 days"),getRangeValue:()=>({preset:4,start:F.subtract({days:7}),end:H(F)})},{key:6,label:I("Last 30 days"),getRangeValue:()=>({preset:6,start:F.subtract({days:30}),end:H(F)})},{key:7,label:I("Last 3 months"),getRangeValue:()=>({preset:7,start:F.subtract({months:3}),end:H(F)})},{key:8,label:I("Last 12 months"),getRangeValue:()=>({preset:8,start:F.subtract({months:12}),end:H(F)})},{key:9,label:I("This month"),getRangeValue:()=>({preset:9,start:be(F),end:ve(H(F))})},{key:10,label:I("This year"),getRangeValue:()=>({preset:10,start:Rs(F),end:zs(H(F))})},{key:11,label:I("Last year"),getRangeValue:()=>({preset:11,start:Rs(F).subtract({years:1}),end:zs(H(F)).subtract({years:1})})}],Dt=G(s.jsx("path",{d:"M7 11h2v2H7v-2zm14-5v14c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2zM5 8h14V6H5v2zm14 12V10H5v10h14zm-4-7h2v-2h-2v2zm-4 0h2v-2h-2v2z"}),"DateRangeOutlined"),Pt=Ke.forwardRef((e,t)=>{const{children:a,inputProps:n,wrapperProps:r,className:i,autoFocus:c,style:l,onClick:o}=e;return s.jsx("div",{...r,onClick:o,children:s.jsx("div",{...n,role:"group",className:S(i,"flex items-center focus-within:ring focus-within:ring-primary/focus focus-within:border-primary/60"),ref:t,style:l,children:s.jsx(ta,{autoFocus:c,children:a})})})}),St=Ke.forwardRef(({inputRef:e,wrapperProps:t,children:a,onBlur:n,...r},i)=>{const c=us(r),l=et(i),{fieldProps:o,inputProps:f}=st({...r,focusRef:l,labelElementType:"span"});return c.wrapper=S(c.wrapper,r.disabled&&"pointer-events-none"),s.jsx(tt,{wrapperProps:Ie(t,{onBlur:m=>{l.current.contains(m.relatedTarget)||n==null||n(m)},onClick:()=>{const m=aa(l);m==null||m.focusFirst()}}),fieldClassNames:c,ref:l,...o,children:s.jsx(Pt,{inputProps:f,className:S(c.input,"gap-10"),ref:e,children:a})})});function xn(e){return e instanceof na?"day":"minute"}function os(e,t,a){return t!=null&&e.compare(t)<0||a!=null&&e.compare(a)>0}function At(e,t){const a=ms(),[n,r]=u.useState(!1),i=t.closeDialogOnSelection??!0,c=t.granularity||xn(e),l=t.min?Y(t.min,a):void 0,o=t.max?Y(t.max,a):void 0;return{timezone:a,granularity:c,min:l,max:o,calendarIsOpen:n,setCalendarIsOpen:r,closeDialogOnSelection:i}}function Fe(){const e=ms();return u.useMemo(()=>Xs(e),[e])}function _s(e){var le,Q;const t=Fe(),[a,n]=u.useState({start:(!e.value||!e.value.start)&&!((le=e.defaultValue)!=null&&le.start),end:(!e.value||!e.value.end)&&!((Q=e.defaultValue)!=null&&Q.end)}),r=e.onChange,[i,c]=We(e.value?ls(e.value,t):void 0,e.value?void 0:ls(e.defaultValue,t),v=>{n({start:!1,end:!1}),r==null||r(v)}),{min:l,max:o,granularity:f,timezone:m,calendarIsOpen:x,setCalendarIsOpen:p,closeDialogOnSelection:h}=At(i.start,e),g=u.useCallback(()=>{n({start:!0,end:!0}),c(ls(null,t)),r==null||r(null),p(!1)},[t,c,r,p]),[j,y]=u.useState(null),[k,w]=u.useState(!1),[A,D]=u.useState(i),[z,O]=u.useState(()=>Os(i,o)),b=u.useCallback(v=>{let N=v.start,T=v.end;l&&(N=as(N,l));const U=o?ns(o,T):T;N=ns(N,U);const fe=l?as(l,N):N;return T=as(T,fe),o&&(T=ns(T,o)),{start:Y(N,m),end:Y(T,m)}},[l,o,m]),C=u.useCallback(v=>{const N={...b(v),preset:v.preset};c(N),D(N),O(Os(N,o)),n({start:!1,end:!1})},[c,b,o]),P=u.useCallback(v=>!a.start&&he(v,A.start)||!a.end&&he(v,A.end),[A,a]),$=u.useCallback(v=>(k||!a.start&&!a.end)&&v.compare(A.start)>=0&&v.compare(A.end)<=0,[A,a,k]),K=u.useCallback(v=>he(v,A.start),[A]),B=u.useCallback(v=>he(v,A.end),[A]),ie=u.useCallback((v,N)=>({onPointerEnter:()=>{k&&N&&D(is({start:j,end:v,timezone:m}))},onClick:()=>{if(!k)w(!0),y(v),D(is({start:v,end:v,timezone:m}));else{const T=is({start:j,end:v,timezone:m});T.start=It(T.start),T.end=H(T.end),w(!1),y(null),C==null||C(T),h&&(p==null||p(!1))}}}),[j,k,C,p,h,m]);return{selectedValue:i,setSelectedValue:C,calendarIsOpen:x,setCalendarIsOpen:p,dayIsActive:P,dayIsHighlighted:$,dayIsRangeStart:K,dayIsRangeEnd:B,getCellProps:ie,calendarDates:z,setIsPlaceholder:n,isPlaceholder:a,clear:g,setCalendarDates:O,min:l,max:o,granularity:f,timezone:m,closeDialogOnSelection:h}}function Os(e,t){let a=ye(be(e.start)),n=ye(ve(e.end));return at(a,n)&&(n=ve(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=be(a.subtract({months:1}))),[a,n]}function is(e){const t=Y(e.start,e.timezone),a=Y(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function ls(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}const fn=G(s.jsx("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4v3z"}),"ArrowRightAltOutlined");function hn(e,t,a,n){switch(t){case"era":case"year":case"month":case"day":return e.cycle(t,a,{round:t==="year"})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return e.set({hour:i?r-12:r+12})}case"hour":case"minute":case"second":return e.cycle(t,a,{round:t!=="hour",hourCycle:n.hour12?12:24})}return e}function pn(e,t,a,n){switch(t){case"day":case"month":case"year":return e.set({[t]:a})}if("hour"in e)switch(t){case"dayPeriod":{const r=e.hour,i=r>=12;return a>=12===i?e:e.set({hour:i?r-12:r+12})}case"hour":if(n.hour12){const i=e.hour>=12;!i&&a===12&&(a=0),i&&a<12&&(a+=12)}case"minute":case"second":return e.set({[t]:a})}return e}const Hs={year:5,month:2,day:7,hour:2,minute:15,second:15,dayPeriod:1};function gn({segment:e,domProps:t,value:a,onChange:n,isPlaceholder:r,state:{timezone:i,calendarIsOpen:c,setCalendarIsOpen:l}}){const o=te(),f=u.useRef(""),{localeCode:m}=ae(),x=Ge(),p=J({timeZone:i}),h=u.useMemo(()=>new ra(m,{maximumFractionDigits:0}),[m]),g=b=>{n(pn(a,e.type,b,p.resolvedOptions()))},j=b=>{n(hn(a,e.type,b,p.resolvedOptions()))},y=()=>{if(h.isValidPartialNumber(e.text)){const b=e.text.slice(0,-1),C=h.parse(b);if(b.length===0||C===0){const P=ia(i);e.type in P&&g(P[e.type])}else g(C);f.current=b}else e.type==="dayPeriod"&&j(-1)},k=b=>{var C;if(!(b.ctrlKey||b.metaKey||b.shiftKey||b.altKey)){switch(b.key){case"ArrowLeft":b.preventDefault(),b.stopPropagation(),x==null||x.focusPrevious();break;case"ArrowRight":b.preventDefault(),b.stopPropagation(),x==null||x.focusNext();break;case"Enter":(C=b.target.closest("form"))==null||C.requestSubmit(),l(!c);break;case"Tab":break;case"Backspace":case"Delete":{b.preventDefault(),b.stopPropagation(),y();break}case"ArrowUp":b.preventDefault(),f.current="",j(1);break;case"ArrowDown":b.preventDefault(),f.current="",j(-1);break;case"PageUp":b.preventDefault(),f.current="",j(Hs[e.type]||1);break;case"PageDown":b.preventDefault(),f.current="",j(-(Hs[e.type]||1));break;case"Home":b.preventDefault(),f.current="",g(e.maxValue);break;case"End":b.preventDefault(),f.current="",g(e.minValue);break}z(b.key)}},w=J({hour:"numeric",hour12:!0}),A=u.useMemo(()=>{const b=new Date;return b.setHours(0),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),D=u.useMemo(()=>{const b=new Date;return b.setHours(12),w.formatToParts(b).find(C=>C.type==="dayPeriod").value},[w]),z=b=>{const C=f.current+b;switch(e.type){case"dayPeriod":if(A.toLowerCase().startsWith(b))g(0);else if(D.toLowerCase().startsWith(b))g(12);else break;x==null||x.focusNext();break;case"day":case"hour":case"minute":case"second":case"month":case"year":{if(!h.isValidPartialNumber(C))return;let P=h.parse(C),$=P,K=e.minValue===0;if(e.type==="hour"&&p.resolvedOptions().hour12){switch(p.resolvedOptions().hourCycle){case"h11":P>11&&($=h.parse(b));break;case"h12":K=!1,P>12&&($=h.parse(b));break}e.value>=12&&P>1&&(P+=12)}else P>e.maxValue&&($=h.parse(b));if(Number.isNaN(P))return;const B=$!==0||K;B&&g($),+`${P}0`>e.maxValue||C.length>=String(e.maxValue).length?(f.current="",B&&(x==null||x.focusNext())):f.current=C;break}}},O=o?{}:{"aria-label":e.type,"aria-valuetext":r?void 0:`${e.value}`,"aria-valuemin":e.minValue,"aria-valuemax":e.maxValue,"aria-valuenow":r?void 0:e.value,tabIndex:0,onKeyDown:k};return s.jsx("div",{...Ie(t,{...O,onFocus:b=>{f.current="",b.target.scrollIntoView({block:"nearest"})},onClick:b=>{b.preventDefault(),b.stopPropagation()}}),className:"box-content cursor-default select-none whitespace-nowrap rounded p-2 text-center tabular-nums caret-transparent outline-none focus:bg-primary focus:text-on-primary",children:e.text.padStart(e.minLength,"0")})}function jn({segment:e,domProps:t}){const a=Ge();return s.jsx("div",{...t,onPointerDown:n=>{n.pointerType==="mouse"&&(n.preventDefault(),a!=null&&a.focusNext({from:n.target})||a==null||a.focusPrevious({from:n.target}))},"aria-hidden":!0,className:"min-w-4 cursor-default select-none",children:e.text})}function bn(e,t,a){switch(t){case"year":return{value:e.year,placeholder:"yyyy",minValue:1,maxValue:e.calendar.getYearsInEra(e)};case"month":return{value:e.month,placeholder:"mm",minValue:oa(e),maxValue:e.calendar.getMonthsInYear(e)};case"day":return{value:e.day,minValue:la(e),maxValue:e.calendar.getDaysInMonth(e),placeholder:"dd"}}if("hour"in e)switch(t){case"dayPeriod":return{value:e.hour>=12?12:0,minValue:0,maxValue:12,placeholder:"--"};case"hour":if(a.hour12){const n=e.hour>=12;return{value:e.hour,minValue:n?12:0,maxValue:n?23:11,placeholder:"--"}}return{value:e.hour,minValue:0,maxValue:23,placeholder:"--"};case"minute":return{value:e.minute,minValue:0,maxValue:59,placeholder:"--"}}return{}}function cs({segmentProps:e,state:t,value:a,onChange:n,isPlaceholder:r}){const{granularity:i}=t,c=u.useMemo(()=>{const m={year:"numeric",month:"numeric",day:"numeric"};return i==="minute"&&(m.hour="numeric",m.minute="numeric"),m},[i]),l=J(c),o=u.useMemo(()=>a.toDate(),[a]),f=u.useMemo(()=>l.formatToParts(o).map(m=>{const x=bn(a,m.type,l.resolvedOptions()),p=r&&m.type!=="literal"?x.placeholder:m.value;return{type:m.type,text:m.value===", "?" ":p,...x,minLength:m.type!=="literal"?String(x.maxValue).length:1}}),[o,l,r,a]);return s.jsx("div",{className:"flex items-center",children:f.map((m,x)=>m.type==="literal"?s.jsx(jn,{domProps:e,segment:m},x):s.jsx(gn,{isPlaceholder:r,domProps:e,state:t,value:a,onChange:n,segment:m},x))})}function vn({date:e,currentMonth:t,state:{dayIsActive:a,dayIsHighlighted:n,dayIsRangeStart:r,dayIsRangeEnd:i,getCellProps:c,timezone:l,min:o,max:f}}){const{localeCode:m}=ae(),x=ca(e,m),p=a(e),h=n(e),g=r(e),j=i(e),y=da(e,l),k=at(e,t),w=os(e,o,f);return s.jsxs("div",{role:"button","aria-disabled":w,className:S("w-40 h-40 text-sm relative isolate flex-shrink-0",w&&"text-disabled pointer-events-none",!k&&"invisible pointer-events-none"),...c(e,k),children:[s.jsx("span",{className:S("absolute inset-0 flex items-center justify-center rounded-full w-full h-full select-none z-10 cursor-pointer",!p&&!y&&"hover:bg-hover",p&&"bg-primary text-on-primary font-semibold",y&&!p&&"bg-chip"),children:e.day}),h&&k&&s.jsx("span",{className:S("absolute w-full h-full inset-0 bg-primary/focus",(g||x===0||e.day===1)&&"rounded-l-full",(j||x===6||e.day===t.calendar.getDaysInMonth(t))&&"rounded-r-full")})]})}function yn({startDate:e,state:t,isFirst:a,isLast:n}){const{localeCode:r}=ae(),i=ua(e,r),c=Ee(e,r);return s.jsxs("div",{className:"w-280 flex-shrink-0",children:[s.jsx(kn,{isFirst:a,isLast:n,state:t,currentMonth:e}),s.jsxs("div",{className:"block",role:"grid",children:[s.jsx(wn,{state:t,startDate:e}),[...new Array(i).keys()].map(l=>s.jsx(X.div,{className:"flex mb-6",children:[...new Array(7).keys()].map(o=>s.jsx(vn,{date:c.add({weeks:l,days:o}),currentMonth:e,state:t},o))},l))]})]})}function kn({currentMonth:e,isFirst:t,isLast:a,state:{calendarDates:n,setCalendarDates:r,timezone:i,min:c,max:l}}){const o=p=>{const h=n.length;let g;p==="forward"?g=n.map(j=>ve(j.add({months:h}))):g=n.map(j=>ve(j.subtract({months:h}))),r(g)},f=J({month:"long",year:"numeric",era:e.calendar.identifier!=="gregory"?"long":void 0,calendar:e.calendar.identifier}),m=os(e.subtract({days:1}),c,l),x=os(be(e.add({months:1})),c,l);return s.jsxs("div",{className:"flex items-center justify-between gap-10",children:[s.jsx(q,{size:"md",className:S("text-muted",!t&&"invisible"),disabled:!t||m,"aria-hidden":!t,onClick:()=>{o("backward")},children:s.jsx(Oa,{})}),s.jsx("div",{className:"text-sm font-semibold select-none",children:f.format(e.toDate(i))}),s.jsx(q,{size:"md",className:S("text-muted",!a&&"invisible"),disabled:!a||x,"aria-hidden":!a,onClick:()=>{o("forward")},children:s.jsx(Ha,{})})]})}function wn({state:{timezone:e},startDate:t}){const{localeCode:a}=ae(),n=J({weekday:"short"}),r=Ee(t,a);return s.jsx("div",{className:"flex",children:[...new Array(7).keys()].map(i=>{const l=r.add({days:i}).toDate(e),o=n.format(l);return s.jsx("div",{className:"w-40 h-40 text-sm font-semibold relative flex-shrink-0",children:s.jsx("div",{className:"absolute flex items-center justify-center w-full h-full select-none",children:o})},i)})})}function Tt({state:e,visibleMonths:t=1}){return te()&&(t=1),s.jsx(u.Fragment,{children:[...new Array(t).keys()].map(n=>{const r=ye(be(e.calendarDates[n])),i=n===0,c=n===t-1;return s.jsx(yn,{state:e,startDate:r,isFirst:i,isLast:c},n)})})}const Ft=u.memo(({start:e,end:t,options:a,preset:n})=>{const{dates:r}=oe(),i=ms(),c=J(a||nt[n||(r==null?void 0:r.format)]);if(!e||!t)return null;let l;try{l=c.formatRange(qs(e,i),qs(t,i))}catch{l=""}return s.jsx(u.Fragment,{children:l})},rt);function qs(e,t){return typeof e=="string"?ma(e,t).toDate():"toDate"in e?e.toDate(t):e}function Nn({onPresetSelected:e,selectedValue:t}){return s.jsx(it,{children:Ct.map(a=>s.jsx(lt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx(d,{...a.label})},a.key))})}const Vt=[{key:0,label:I("Preceding period"),getRangeValue:e=>{const t=e.start,r=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:r}),end:t}}},{key:1,label:I("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:I("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function In({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(it,{children:Vt.map(n=>s.jsx(lt,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const r=n.getRangeValue(e);t(r)},children:s.jsx(d,{...n.label})},n.key))})}function Cn({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const r=qa(),{close:i}=xs(),c=u.useRef(e),l=e.isPlaceholder.start||e.isPlaceholder.end,[o,f]=u.useState(n),m=s.jsxs(Qe,{dividerTop:!0,startAction:!l&&!r?s.jsx("div",{className:"text-xs",children:s.jsx(Ft,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(V,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(c.current.selectedValue),e.setIsPlaceholder(c.current.isPlaceholder),i()},children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const x=e.selectedValue;t&&o&&(x.compareStart=t.selectedValue.start,x.compareEnd=t.selectedValue.end),i(x)},children:s.jsx(d,{message:"Select"})})]});return s.jsxs(Ce,{size:"auto",children:[s.jsxs(De,{className:"flex",padding:"p-0",children:[!r&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(Nn,{selectedValue:e.selectedValue,onPresetSelected:x=>{e.setSelectedValue(x),e.closeDialogOnSelection&&i(x)}}),!!t&&s.jsxs(u.Fragment,{children:[s.jsx(jt,{className:"mx-20 mb-10 mt-14",checked:o,onChange:x=>f(x.target.checked),children:s.jsx(d,{message:"Compare"})}),o&&s.jsx(In,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:x=>{t.setSelectedValue(x)}})]})]}),s.jsx(Ze,{initial:!1,children:s.jsx(Dn,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:o})})]}),!e.closeDialogOnSelection&&m]})}function Dn({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(X.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(Bs,{state:e}),!!t&&n&&s.jsx(Bs,{state:t,label:s.jsx(d,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(Tt,{state:e,visibleMonths:2})})]})}function Bs({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(St,{className:"mb-20 mt-10",label:t,children:[s.jsx(cs,{state:e,value:a.start,onChange:r=>{n({...a,start:r})}}),s.jsx(fn,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(cs,{state:e,value:a.end,onChange:r=>{n({...a,end:r})}})]})}const xe=(e,t)=>{const a=e.split("/");return t&&a.push(t),a};function ji(e,t,a,n){return ne({queryKey:xe(e,t),queryFn:({signal:r})=>Pn(e,t,n,r),placeholderData:Ye,...a})}async function Pn(e,t,a,n){t.query&&await new Promise(i=>setTimeout(i,300));const r=await L.get(e,{params:t,signal:t.query?n:void 0}).then(i=>i.data);return a==null||a(r),r}function $t(e,t,a){return ne({queryKey:[e,t],queryFn:()=>Sn(e,t),placeholderData:Ye,...a})}async function Sn(e,t){return L.get(e,{params:t}).then(a=>a.data)}function Rt(e,t,a){return ne({queryKey:[e,t],queryFn:()=>An(e,t),...a})}async function An(e,t){return L.get(e,{params:t}).then(a=>a.data)}function Tn({label:e,className:t,background:a,value:n,defaultValue:r="",placeholder:i=I("Select item..."),searchPlaceholder:c=I("Find an item..."),onChange:l,description:o,errorMessage:f,invalid:m,autoFocus:x,queryParams:p,endpoint:h,disabled:g,required:j}){var C;const y=u.useRef(null),[k,w]=u.useState(""),[A,D]=We(n,r,l),z=$t(h,{query:k,...p}),{trans:O}=_(),b=us({size:"md"});return A?s.jsxs("div",{className:t,children:[s.jsx("div",{className:b.label,children:e}),s.jsx("div",{className:S("rounded-input border p-8",a,m&&"border-danger"),children:s.jsx(Ze,{initial:!1,mode:"wait",children:s.jsx(Fn,{disabled:g,endpoint:h,modelId:A,queryParams:p,onEditClick:()=>{D(""),w(""),requestAnimationFrame(()=>{var P,$;(P=y.current)==null||P.focus(),($=y.current)==null||$.click()})}})})}),o&&!f&&s.jsx("div",{className:b.description,children:o}),f&&s.jsx("div",{className:b.error,children:f})]}):s.jsx(xa,{className:t,showSearchField:!0,invalid:m,errorMessage:f,description:o,color:"white",isAsync:!0,background:a,placeholder:O(i),searchPlaceholder:O(c),label:e,isLoading:z.isFetching,items:(C=z.data)==null?void 0:C.results,inputValue:k,onInputValueChange:w,selectionMode:"single",selectedValue:A,onSelectionChange:D,ref:y,autoFocus:x,disabled:g,required:j,children:P=>s.jsx(hs,{value:P.id,description:P.description,startIcon:s.jsx(ks,{src:P.image}),children:P.name},P.id)})}function Fn({modelId:e,onEditClick:t,endpoint:a,disabled:n,queryParams:r}){const{data:i,isLoading:c}=Rt(`${a}/${e}`,r);return c||!(i!=null&&i.model)?s.jsx(Vn,{},"skeleton"):s.jsxs(X.div,{className:S("flex items-center gap-10",n&&"pointer-events-none cursor-not-allowed text-disabled"),...ps,children:[i.model.image&&s.jsx(ks,{src:i.model.image}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm leading-4",children:i.model.name}),s.jsx("div",{className:"text-xs text-muted",children:i.model.description})]}),s.jsx(ke,{label:s.jsx(d,{message:"Change item"}),children:s.jsx(q,{className:"ml-auto text-muted",size:"sm",onClick:t,disabled:n,children:s.jsx(Ds,{})})})]},"preview")}function Vn(){return s.jsxs(X.div,{className:"flex items-center gap-10",...ps,children:[s.jsx(pe,{variant:"rect",size:"w-32 h-32"}),s.jsxs("div",{className:"max-h-[36px] flex-auto",children:[s.jsx(pe,{className:"text-xs"}),s.jsx(pe,{className:"max-h-8 text-xs"})]}),s.jsx(pe,{variant:"icon",size:"w-24 h-24"})]})}function $n({name:e,...t}){const{clearErrors:a}=Pe(),{field:{onChange:n,value:r=""},fieldState:{invalid:i,error:c}}=fs({name:e});return s.jsx(Tn,{value:r,onChange:l=>{n(l),a(e)},invalid:i,errorMessage:c==null?void 0:c.message,...t})}function ds(e){return{id:e,name:`${e}`,description:`${e}`}}function Rn(e,t){const a=u.useRef(null),n=et(t),{displayWith:r=U=>U.name,validateWith:i,children:c,suggestions:l,isLoading:o,inputValue:f,onInputValueChange:m,onItemSelected:x,placeholder:p,onOpenChange:h,chipSize:g="sm",openMenuOnFocus:j=!0,showEmptyMessage:y,value:k,defaultValue:w,onChange:A,valueKey:D,isAsync:z,allowCustomValue:O=!0,showDropdownArrow:b,onChipClick:C,...P}=e,$=us({...e,flexibleHeight:!0}),[K,B]=Ln(e),[ie,le]=u.useState(!1),Q=s.jsx(gs,{isIndeterminate:!0,size:"sm","aria-label":"loading..."}),v=b?s.jsx(ja,{}):null,{fieldProps:N,inputProps:T}=st({...P,focusRef:n,endAdornment:o&&ie?Q:v});return s.jsx(tt,{fieldClassNames:$,...N,children:s.jsxs(Pt,{ref:a,className:S("flex flex-wrap items-center",$.input),onClick:()=>{var U;(U=n.current)==null||U.focus()},children:[s.jsx(zn,{displayChipUsing:r,onChipClick:C,items:K,setItems:B,chipSize:g}),s.jsx(Mn,{showEmptyMessage:y,inputProps:T,inputValue:f,onInputValueChange:m,fieldRef:a,inputRef:n,chips:K,setChips:B,validateWith:i,isLoading:o,suggestions:l,placeholder:p,openMenuOnFocus:j,listboxIsOpen:ie,setListboxIsOpen:le,allowCustomValue:O,children:c})]})})}function zn({items:e,setItems:t,displayChipUsing:a,chipSize:n,onChipClick:r}){const i=Ge(),c=u.useCallback(l=>{const o=e.findIndex(m=>m.id===l),f=[...e];return o>-1&&(f.splice(o,1),t(f)),f},[e,t]);return s.jsx(bt,{className:"my-8 max-w-full flex-shrink-0 flex-wrap",size:n,selectable:!0,children:e.map(l=>s.jsx(ot,{errorMessage:l.errorMessage,adornment:l.image?s.jsx(ks,{circle:!0,src:l.image}):null,onClick:()=>r==null?void 0:r(l),onRemove:()=>{c(l.id).length?i==null||i.focusPrevious({tabbable:!0}):i==null||i.focusLast()},children:a(l)},l.id))})}function Mn(e){const{inputRef:t,fieldRef:a,validateWith:n,setChips:r,chips:i,suggestions:c,inputProps:l,placeholder:o,openMenuOnFocus:f,listboxIsOpen:m,setListboxIsOpen:x,allowCustomValue:p,isLoading:h}=e,g="outline-none text-sm mx-8 my-4 h-30 flex-auto",j=Ge(),y=u.useCallback(v=>{v=(v||[]).filter(N=>{const T=!N||!N.id||!N.name;return!(i.findIndex(fe=>fe.id===(N==null?void 0:N.id))>-1)&&!T}),v.length&&(n&&(v=v.map(N=>n(N))),r([...i,...v]))},[i,r,n]),k=fa({...e,clearInputOnItemSelection:!0,isOpen:m,onOpenChange:x,items:c,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:v=>{B(v)}}),{state:{activeIndex:w,setActiveIndex:A,isOpen:D,setIsOpen:z,inputValue:O,setInputValue:b},refs:C,listboxId:P,collection:$,onInputChange:K}=k,B=v=>{const N=$.size&&w!=null?[...$.values()][w]:null;N!=null&&N.item?y([N.item]):p&&y([ds(N?N.value:v)]),b(""),A(null),z(!1)};ha(()=>{a.current&&C.reference.current!==a.current&&k.reference(a.current)},[a,k,C]);const{handleTriggerKeyDown:ie,handleListboxKeyboardNavigation:le}=ba(k),Q=va(()=>{f&&!D&&z(!0)});return s.jsx(pa,{listbox:k,mobileOverlay:ga,isLoading:h,onPointerDown:v=>{v.preventDefault()},children:s.jsx("input",{type:"text",className:S(g,"bg-transparent"),placeholder:o,...Ie(l,{ref:t,value:O,onChange:K,onPaste:v=>{const T=v.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(T){v.preventDefault();const U=window.getSelection();U!=null&&U.rangeCount&&(U.deleteFromDocument(),y(T.map(fe=>ds(fe))))}},"aria-autocomplete":"list","aria-controls":D?P:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:v=>{const N=v.target;if(v.key==="Enter"){v.preventDefault(),B(N.value);return}if(v.key==="Escape"&&D&&(z(!1),b("")),v.key==="ArrowUp"&&D&&(w===0||w==null)){A(null);return}if(w!=null&&(v.key==="ArrowLeft"||v.key==="ArrowRight")){v.preventDefault();return}if((v.key==="ArrowLeft"||v.key==="Backspace"||v.key==="Delete")&&N.selectionStart===0&&w==null&&i.length){j==null||j.focusPrevious({tabbable:!0});return}ie(v)||le(v)},onFocus:Q,onClick:Q})})})}function Ln({onChange:e,value:t,defaultValue:a,valueKey:n}){const r=u.useMemo(()=>Ks(t),[t]),i=u.useMemo(()=>Ks(a),[a]),c=u.useCallback(l=>{const o=n?l.map(f=>f[n]):l;e==null||e(o)},[e,n]);return We(r||void 0,i||[],c)}function Ks(e){if(e!=null)return e.map(t=>typeof t!="object"?ds(t):t)}const Un=Ke.forwardRef(Rn);function zt({children:e,...t}){const{field:{onChange:a,onBlur:n,value:r=[],ref:i},fieldState:{invalid:c,error:l}}=fs({name:t.name}),o={onChange:a,onBlur:n,value:r,invalid:c,errorMessage:l==null?void 0:l.message};return s.jsx(Un,{ref:i,...Ie(o,t),children:e})}function En(e){const t=Fe(),[a,n]=u.useState(!e.value&&!e.defaultValue),r=e.onChange,[i,c]=We(e.value||t,e.defaultValue||t,D=>{n(!1),r==null||r(D)}),{min:l,max:o,granularity:f,timezone:m,calendarIsOpen:x,setCalendarIsOpen:p,closeDialogOnSelection:h}=At(i,e),g=u.useCallback(()=>{n(!0),c(t),r==null||r(null),p(!1)},[t,c,r,p]),[j,y]=u.useState(()=>[ye(i)]),k=u.useCallback(D=>{l&&D.compare(l)<0?D=l:o&&D.compare(o)>0&&(D=o);const z=i?i.set(D):Y(D,m);c(z),y([ye(z)]),n(!1)},[c,l,o,i,m]),w=u.useCallback(D=>!a&&he(i,D),[i,a]),A=u.useCallback(D=>({onClick:()=>{k==null||k(D),h&&(p==null||p(!1))}}),[k,p,h]);return{selectedValue:i,setSelectedValue:c,calendarIsOpen:x,setCalendarIsOpen:p,dayIsActive:w,dayIsHighlighted:()=>!1,dayIsRangeStart:()=>!1,dayIsRangeEnd:()=>!1,getCellProps:A,calendarDates:j,setCalendarDates:y,isPlaceholder:a,clear:g,setIsPlaceholder:n,min:l,max:o,granularity:f,timezone:m,closeDialogOnSelection:h}}function _n({showCalendarFooter:e,...t}){const a=En(t),n=u.useRef(null),r=Fe(),i=e&&s.jsx(Qe,{padding:"px-14 pb-14",startAction:s.jsx(V,{disabled:a.isPlaceholder,variant:"text",color:"primary",onClick:()=>{a.clear()},children:s.jsx(d,{message:"Clear"})}),children:s.jsx(V,{variant:"text",color:"primary",onClick:()=>{a.setSelectedValue(r),a.setCalendarIsOpen(!1)},children:s.jsx(d,{message:"Today"})})}),c=s.jsx(ee,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:n,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsxs(Ce,{size:"auto",children:[s.jsx(De,{className:"flex items-start gap-40",padding:e?"px-24 pt-20 pb-10":null,children:s.jsx(Tt,{state:a,visibleMonths:1})}),i]})}),l={onClick:o=>{o.stopPropagation(),o.preventDefault(),Hn(o)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}};return s.jsxs(u.Fragment,{children:[s.jsx(St,{ref:n,wrapperProps:l,endAdornment:s.jsx(Dt,{className:S(t.disabled&&"text-disabled")}),...t,children:s.jsx(cs,{segmentProps:l,state:a,value:a.selectedValue,onChange:a.setSelectedValue,isPlaceholder:a.isPlaceholder})}),c]})}function On(e){const{min:t,max:a}=e,{trans:n}=_(),{format:r}=J(),{field:{onChange:i,onBlur:c,value:l=null,ref:o},fieldState:{invalid:f,error:m}}=fs({name:e.name,rules:{validate:h=>{if(!h)return;const g=_e(h);if(t&&g.compare(t)<0)return n({message:"Enter a date after :date",values:{date:r(h)}});if(a&&g.compare(a)>0)return n({message:"Enter a date before :date",values:{date:r(h)}})}}}),x=l?_e(l):null,p={onChange:h=>{i(h&&h.toAbsoluteString())},onBlur:c,value:x,invalid:f,errorMessage:m==null?void 0:m.message,inputRef:o};return s.jsx(_n,{...Ie(p,e)})}function Hn(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}const qn=G(s.jsx("path",{d:"M20 9H4v2h16V9zM4 15h16v-2H4v2z"}),"DragHandleOutlined");function Bn(){const[e,t]=u.useState(!1),a=u.useRef(),n=u.useCallback(r=>{var i;if(r){const c=new IntersectionObserver(([l])=>t(l.intersectionRatio<1),{threshold:[1]});a.current=c,c.observe(r)}else a.current&&((i=a.current)==null||i.disconnect())},[]);return{isSticky:e,sentinelRef:n}}function Ve({onSubmit:e,form:t,title:a,subTitle:n,children:r,actions:i,backButton:c,isLoading:l=!1,disableSaveWhenNotDirty:o=!1,wrapInContainer:f=!0}){const{isSticky:m,sentinelRef:x}=Bn(),p=o?Object.keys(t.formState.dirtyFields).length:!0;return s.jsxs(Se,{onSubmit:e,onBeforeSubmit:()=>t.clearErrors(),form:t,children:[s.jsx("div",{ref:x}),s.jsx("div",{className:S("sticky top-0 z-10 my-12 transition-shadow md:my-24",m&&"bg-paper shadow"),children:s.jsxs("div",{className:S("flex items-center gap-24 py-14 md:items-start",f&&"container mx-auto px-24"),children:[c,s.jsxs("div",{className:"overflow-hidden overflow-ellipsis md:mr-64",children:[s.jsx("h1",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap text-xl md:text-3xl",children:a}),n&&s.jsx("div",{className:"mt-4",children:n})]}),s.jsx("div",{className:"mr-auto"}),i,s.jsx(V,{variant:"flat",color:"primary",type:"submit",disabled:l||!p,children:s.jsx(d,{message:"Save"})})]})}),s.jsx("div",{className:f?"container mx-auto px-24 pb-24":void 0,children:s.jsx("div",{className:"rounded",children:r})})]})}const Mt=""+new URL("music-7a11c2fe.svg",import.meta.url).href;function Kn(e){return ne({queryKey:["artists","search-suggestions",e],queryFn:()=>Wn(e),placeholderData:Ye})}async function Wn(e){return L.get("search/suggestions/artist",{params:e}).then(t=>t.data)}function Lt({name:e,className:t}){const{trans:a}=_(),[n,r]=u.useState(""),{data:i,isLoading:c}=Kn({query:n});return s.jsx(zt,{className:t,name:e,label:s.jsx(d,{message:"Artists"}),isAsync:!0,inputValue:n,onInputValueChange:r,suggestions:i==null?void 0:i.results,placeholder:a(I("+Add artist")),isLoading:c,allowCustomValue:!1,children:i==null?void 0:i.results.map(l=>s.jsx(hs,{value:l,startIcon:l.image?s.jsx("img",{className:"rounded-full object-cover w-24 h-24",src:l.image,alt:""}):void 0,children:l.name},l.id))})}function we({name:e,label:t,placeholder:a,model:n,className:r,allowCustomValue:i=!1}){const[c,l]=u.useState(""),{data:o,isLoading:f}=$t(`normalized-models/${n}`,{query:c});return s.jsx(zt,{className:r,name:e,label:t,isAsync:!0,inputValue:c,onInputValueChange:l,suggestions:o==null?void 0:o.results,placeholder:a,isLoading:f,allowCustomValue:i,children:o==null?void 0:o.results.map(m=>s.jsx(hs,{value:m,startIcon:m.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:m.image,alt:""}):void 0,children:m.name},m.id))})}const Ut="tag",Et=G(s.jsx("path",{d:"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zM7 9l1.41 1.41L11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5-5 5z"}),"FileUploadOutlined");function _t({fileUpload:e,status:t,className:a}){const n=(e==null?void 0:e.bytesUploaded)||0,r=u.useMemo(()=>Ms(e.file.size),[e.file.size]),i=u.useMemo(()=>Ms(n),[n]);let c;return t==="completed"?c=s.jsx(d,{message:"Upload complete"}):t==="aborted"?c=s.jsx(d,{message:"Upload cancelled"}):t==="failed"?c=s.jsx(d,{message:"Upload failed"}):t==="processing"?c=s.jsx(d,{message:"Processing upload..."}):t==="pending"?c=s.jsx(d,{message:"Waiting to start..."}):c=s.jsx(d,{message:":bytesUploaded of :totalBytes uploaded",values:{bytesUploaded:i,totalBytes:r}}),s.jsx("div",{className:S("text-muted text-xs",a),children:c})}function Ot({fileUpload:e,status:t,onAbort:a,size:n="md",className:r}){return s.jsxs("div",{className:r,children:[s.jsxs("div",{className:"flex items-center gap-24 justify-between",children:[s.jsx(_t,{fileUpload:e,status:t}),s.jsx(Gn,{fileUpload:e,status:t,onAbort:a})]}),s.jsx(ya,{size:n==="sm"?"xs":"sm",radius:"rounded-sm",value:e.percentage,isIndeterminate:t==="processing"||t==="pending"})]})}function Gn({fileUpload:e,status:t,onAbort:a}){R(i=>i.abortUpload),R(i=>i.clearInactive);const n=e.errorMessage;let r;if(t==="failed"){const i=n||I("This file could not be uploaded");r=s.jsx(Me,{children:s.jsx(ke,{variant:"danger",label:s.jsx(ka,{value:i}),children:s.jsx(wa,{className:"text-danger",size:"sm"})})})}else t==="aborted"?r=s.jsx(Me,{children:s.jsx(Na,{className:"text-warning",size:"sm"})}):t==="completed"||t==="processing"?r=s.jsx(Me,{children:s.jsx(Ia,{size:"sm",className:"text-primary"})}):a?r=s.jsx(Me,{children:s.jsx(q,{size:"xs",onClick:()=>a(e.file.id),children:s.jsx(js,{})})}):r=s.jsx("div",{className:"w-30 h-30"});return s.jsx(Ze,{children:r})}function Me({children:e,...t}){return s.jsx(X.div,{className:"flex w-30 h-30 items-center justify-center",...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function Qn(){return ce({mutationFn:e=>Zn(e),onError:e=>Ca(e)})}function Zn(e){return L.post(`tracks/${e.fileEntryId}/extract-metadata`,e).then(t=>Yn(t.data))}function Yn(e){const t={name:e.metadata.title,duration:e.metadata.duration,genres:e.metadata.genres||[],description:e.metadata.comment,lyric:e.metadata.lyrics,release_date:e.metadata.release_date,album_name:e.metadata.album_name};return e.metadata.album&&(t.album_id=e.metadata.album.id),e.metadata.artist&&(t.artists=[e.metadata.artist]),e.metadata.image&&(t.image=e.metadata.image.url),t}function Ht(e,t){var a,n;!((a=e.getValues("artists"))!=null&&a.length)&&t.artists&&e.setValue("artists",t.artists),!e.getValues("image")&&t.image&&e.setValue("image",t.image),t.release_date&&e.setValue("release_date",t.release_date),(n=t.genres)!=null&&n.length&&e.setValue("genres",Ue(e.getValues("genres"),t.genres)),!e.getValues("name")&&t.album_name&&e.setValue("name",t.album_name)}function Ne(e,t){return{...t,...e,artists:Ue(t.artists,e.artists),genres:Ue(t.genres,e.genres,"name"),tags:Ue(t.tags,e.tags,"name")}}function Ue(e=[],t=[],a="id"){return t=t.filter(n=>!e.find(r=>r[a]===n[a])),[...e,...t]}const Jn=50*1024*1024;function ts(e){const{uploads:t}=oe(),a=u.useMemo(()=>({allowedFileTypes:[Ls.audio,Ls.video],maxFileSize:t.max_size||Jn}),[t.max_size]),n=Qn(),r=u.useRef(e);r.current=e;const i=R(h=>h.uploadMultiple),c=R(h=>h.updateFileUpload),l=R(h=>h.getUpload),o=u.useCallback((h,g)=>{var j;c(h,{meta:{...((j=l(h))==null?void 0:j.meta)||{},...g}})},[c,l]),f=u.useMemo(()=>({metadata:{diskPrefix:"track_media",disk:Da.public},restrictions:a,onSuccess:(h,g)=>{o(g.id,{isExtractingMetadata:!0}),n.mutate({fileEntryId:h.id,autoMatchAlbum:r.current.autoMatchAlbum},{onSuccess:j=>{o(g.id,{isExtractingMetadata:!1});const y={...j,src:h.url};r.current.onMetadataChange(g,y)},onError:()=>{o(g.id,{isExtractingMetadata:!1})}})},onError:h=>{h&&se.danger(h)}}),[n,o,a]),m=u.useCallback(h=>{const g=h.filter(j=>!Pa(j,a));return h.length!==g.length&&se.danger(I(":count of your files is not supported.",{values:{count:h.length-g.length}})),g},[a]),x=u.useCallback(async h=>{if(m(h).length){h.forEach(j=>{var y,k;(k=(y=r.current).onUploadStart)==null||k.call(y,{name:j.name,uploadId:j.id})}),i(h,f);for(const j of h){o(j.id,{isGeneratingWave:!0});const y=await Ba(j.native);y&&r.current.onMetadataChange(j,{waveData:y}),o(j.id,{isGeneratingWave:!1})}}},[f,i,o,m]);return{openFilePicker:u.useCallback(async()=>{const h=await Sa({multiple:!0,types:a.allowedFileTypes});await x(h)},[x,a]),uploadTracks:x,validateUploads:m}}function Ps(e){const t=R(r=>e?r.fileUploads.get(e):null);let a=!1,n;if(t){const r=t.meta,i=(r==null?void 0:r.isExtractingMetadata)||(r==null?void 0:r.isGeneratingWave);a=(t==null?void 0:t.status)==="pending"||(t==null?void 0:t.status)==="inProgress"||!!i,n=(t==null?void 0:t.status)==="completed"&&i?"processing":t==null?void 0:t.status}return{isUploading:a,status:n,activeUpload:t}}function Xn(){const[e,t]=u.useState(),{setValue:a,watch:n,getValues:r}=Pe(),{openFilePicker:i}=ts({onUploadStart:({uploadId:x})=>t(x),onMetadataChange:(x,p)=>{const h=Ne(p,r());Object.entries(h).forEach(([g,j])=>a(g,j,{shouldDirty:!0}))}}),{status:c,isUploading:l,activeUpload:o}=Ps(e),{abortUpload:f,clearInactive:m}=R();return s.jsxs("div",{children:[s.jsx(V,{className:"w-full",variant:"flat",color:"primary",startIcon:s.jsx(Et,{}),disabled:l,onClick:()=>i(),children:n("src")?s.jsx(d,{message:"Replace file"}):s.jsx(d,{message:"Upload file"})}),o&&s.jsx(Ot,{fileUpload:o,status:c,className:"mt-24",onAbort:x=>{f(x),m()}})]})}function $e({showExternalIdFields:e,showAlbumField:t=!0,uploadButton:a}){const{trans:n}=_(),r=te();return s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image",diskPrefix:"track_image",variant:r?"input":"square",label:r?s.jsx(d,{message:"Image"}):null,previewSize:r?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),s.jsx("div",{className:"mt-24",children:a||s.jsx(Xn,{})})]}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),t&&s.jsx($n,{className:"mb-24",label:s.jsx(d,{message:"Album"}),name:"album_id",endpoint:"search/suggestions/album"}),s.jsx(Lt,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:n(I("+Add genre")),model:ws,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:n(I("+Add tag")),model:Ut,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),s.jsx(tr,{}),e&&s.jsx(er,{}),e&&s.jsx(sr,{})]})]})}function er(){return s.jsx(M,{name:"src",label:s.jsx(d,{message:"Playback source"}),className:"mb-24",minLength:1,maxLength:230,description:s.jsx(d,{message:"Supports audio, video, hls/dash stream and youtube video url. If left empty, best matching youtube video will be found automatically."})})}function sr(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function tr(){const{watch:e}=Pe();return s.jsx(M,{required:!0,name:"duration",label:s.jsx(d,{message:"Duration (in milliseconds)"}),className:"mb-24",type:"number",min:1,max:864e5,description:s.jsx(d,{message:"Will appear on the site as: :preview",values:{preview:s.jsx(Ka,{ms:e("duration")})}})})}const qt="tracks";function Bt(e,{onSuccess:t}={}){const{trans:a}=_();return ce({mutationFn:n=>ar(n),onSuccess:n=>{se(a(I("Track created"))),de.invalidateQueries({queryKey:xe(qt)}),t==null||t(n)},onError:n=>Ae(n,e)})}function ar(e){return L.post(qt,Ss(e)).then(t=>t.data)}function Ss(e){var t;return{...e,album_id:e.album_id?e.album_id:null,artists:(t=e.artists)==null?void 0:t.map(a=>a.id)}}function Kt({onTrackCreated:e,defaultValues:t}={}){const a=re({defaultValues:t}),n=Bt(a,{onSuccess:e});return{form:a,createTrack:n}}function bi({wrapInContainer:e}){const t=Te(),{pathname:a}=ue(),{form:n,createTrack:r}=Kt({onTrackCreated:i=>{a.includes("admin")?t(`/admin/tracks/${i.track.id}/edit`):t(Oe(i.track))}});return s.jsx(Ve,{form:n,onSubmit:i=>{r.mutate(i)},title:s.jsx(d,{message:"Add new track"}),isLoading:r.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})})}const nr=e=>`tracks/${e}`;function rr(e,t={}){const{trans:a}=_();return ce({mutationFn:n=>ir(n),onSuccess:n=>{var r;se(a(I("Track updated"))),de.invalidateQueries({queryKey:xe("tracks")}),(r=t.onSuccess)==null||r.call(t,n)},onError:n=>Ae(n,e)})}function ir({id:e,...t}){return L.put(nr(e),Ss(t)).then(a=>a.data)}function Wt(e,t={}){var r;const a=re({defaultValues:{...e,image:e.image||((r=e.album)==null?void 0:r.image)}}),n=rr(a,{onSuccess:t.onTrackUpdated});return{form:a,updateTrack:n}}function vi({wrapInContainer:e}){const t=vt({loader:"editTrackPage"});return t.data?s.jsx(lr,{track:t.data.track,wrapInContainer:e}):s.jsx(bs,{query:t,loaderClassName:"absolute inset-0 m-auto",loaderIsScreen:!1})}function lr({track:e,wrapInContainer:t}){const{canEdit:a}=Wa([e]),n=Te(),{pathname:r}=ue(),{form:i,updateTrack:c}=Wt(e,{onTrackUpdated:l=>{r.includes("admin")?n("/admin/tracks"):n(Oe(l.track))}});return a?s.jsx(Ve,{form:i,onSubmit:l=>{c.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}}),isLoading:c.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(me,{children:s.jsx($e,{showExternalIdFields:!0})})}):s.jsx(vs,{to:"/",replace:!0})}const Gt="albums";function Qt(e){const{trans:t}=_();return ce({mutationFn:a=>or(a),onSuccess:()=>{se(t(I("Album created"))),de.invalidateQueries({queryKey:xe(Gt)})},onError:a=>Ae(a,e)})}function or(e){return L.post(Gt,Zt(e)).then(t=>t.data)}function Zt(e){var t,a;return{...e,artists:(t=e.artists)==null?void 0:t.map(n=>n.id),tracks:(a=e.tracks)==null?void 0:a.map(n=>Ss(n))}}const cr=e=>`albums/${e}`;function dr(e,t){const{trans:a}=_(),n=Te(),{pathname:r}=ue();return ce({mutationFn:i=>ur(t,i),onSuccess:i=>{se(a(I("Album updated"))),de.invalidateQueries({queryKey:xe("albums")}),r.includes("admin")?n("/admin/albums"):n(He(i.album))},onError:i=>Ae(i,e)})}function ur(e,t){return L.put(cr(e),Zt(t)).then(a=>a.data)}function mr({track:e,hideAlbumField:t}){const{formId:a,close:n}=xs(),{form:r}=Wt(e);return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ys,{children:s.jsx(d,{message:"Edit “:name“ track",values:{name:e.name}})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Qe,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Update"})})]})]})}function xr({defaultValues:e,hideAlbumField:t}){const{formId:a,close:n}=xs(),{form:r}=Kt({defaultValues:e});return s.jsxs(Ce,{size:"fullscreen",children:[s.jsx(ys,{children:s.jsx(d,{message:"Add new track"})}),s.jsx(De,{children:s.jsx(Se,{id:a,form:r,onSubmit:i=>{n(i)},onBeforeSubmit:()=>{r.clearErrors()},children:s.jsx($e,{showExternalIdFields:!0,showAlbumField:!t})})}),s.jsxs(Qe,{children:[s.jsx(V,{variant:"text",onClick:()=>n(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{form:a,variant:"flat",color:"primary",type:"submit",children:s.jsx(d,{message:"Create"})})]})]})}function fr(){const e=Pe(),{watch:t,setValue:a,getValues:n}=e,{fields:r,remove:i,prepend:c,move:l}=ct({name:"tracks"}),o=(x,p)=>{var g;const h=(g=n("tracks"))==null?void 0:g.findIndex(j=>j.uploadId===x);h!=null&&a(`tracks.${h}`,Ne(p,n(`tracks.${h}`)),{shouldDirty:!0})},{openFilePicker:f}=ts({onUploadStart:x=>c(Ne(x,{artists:e.getValues("artists"),genres:e.getValues("genres"),tags:e.getValues("tags")})),onMetadataChange:(x,p)=>{Ht(e,p),o(x.id,p)}}),m=t("tracks")||[];return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"my-24 text-xl font-semibold",children:s.jsx(d,{message:"Tracks"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Et,{}),onClick:()=>f(),children:s.jsx(d,{message:"Upload tracks"})}),s.jsxs(ee,{type:"modal",onClose:x=>{x&&c(x)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Create track"}),children:s.jsx(q,{variant:"outline",color:"primary",size:"xs",children:s.jsx(Ns,{})})}),s.jsx(xr,{hideAlbumField:!0,defaultValues:{artists:t("artists"),tags:t("tags"),genres:t("genres")}})]})]}),r.map((x,p)=>{const h=m[p];return s.jsx(hr,{track:h,onRemove:()=>i(p),onSort:(g,j)=>l(g,j),tracks:m,onUpdate:g=>{o(h.uploadId,g)}},x.id)}),r.length?null:s.jsx(dt,{className:"mt-40",image:s.jsx(ut,{src:Mt}),title:s.jsx(d,{message:"This album does not have any tracks yet"})})]})}function hr({track:e,tracks:t,onRemove:a,onUpdate:n,onSort:r}){const i=u.useRef(null),c=u.useRef(null),l=R(p=>p.abortUpload),o=R(p=>e.uploadId?p.fileUploads.get(e.uploadId):null),{isUploading:f,status:m}=Ps(e.uploadId),{sortableProps:x}=Qa({disabled:f,ref:i,item:e,items:t,type:"albumFormTrack",preview:c,previewVariant:"line",onSortEnd:(p,h)=>{r(p,h)}});return s.jsxs("div",{className:"border-b border-t border-t-transparent py-4",ref:i,...x,children:[s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(q,{className:"mr-14 flex-shrink-0",disabled:f,children:s.jsx(qn,{})}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),o&&s.jsxs("div",{className:"mr-10 flex items-center",children:[s.jsx(_t,{fileUpload:o,status:m,className:"mr-10"}),s.jsx(gs,{isIndeterminate:m==="processing",value:o.percentage,size:"sm"})]}),s.jsxs(ee,{type:"modal",onClose:p=>{p&&n(p)},children:[s.jsx(ke,{label:s.jsx(d,{message:"Edit track"}),children:s.jsx(q,{className:"ml-auto flex-shrink-0 text-muted",disabled:f,children:s.jsx(Ds,{})})}),s.jsx(mr,{track:e,hideAlbumField:!0})]}),s.jsxs(ee,{type:"modal",onClose:p=>{p&&(e.uploadId&&l(e.uploadId),a())},children:[s.jsx(ke,{label:s.jsx(d,{message:"Remove track"}),children:s.jsx(q,{className:"flex-shrink-0 text-muted",children:s.jsx(js,{})})}),s.jsx(mt,{isDanger:!0,title:s.jsx(d,{message:"Remove track"}),body:s.jsx(d,{message:"Are you sure you want to remove this track from the album?"}),confirm:s.jsx(d,{message:"Remove"})})]})]}),s.jsx(pr,{track:e,ref:c})]})}const pr=Ke.forwardRef(({track:e},t)=>{var n,r;let a=e.name;return(n=e.artists)!=null&&n.length&&(a+=`- ${(r=e.artists)==null?void 0:r[0].name}`),s.jsx(Ga,{ref:t,children:()=>s.jsx("div",{className:"rounded bg-chip p-8 text-sm shadow",children:a})})});function As({showExternalIdFields:e}){const{trans:t}=_(),a=te();return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:"gap-24 md:flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Je,{name:"image",diskPrefix:"album_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:"md:w-full md:w-224 md:aspect-square",stretchPreview:!0})}),s.jsxs("div",{className:"mt-24 flex-auto md:mt-0",children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0}),s.jsx(On,{name:"release_date",label:s.jsx(d,{message:"Release date"}),className:"mb-24",granularity:"day"}),s.jsx(Lt,{name:"artists",className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:ws,name:"genres",allowCustomValue:!0,className:"mb-24"}),s.jsx(we,{label:s.jsx(d,{message:"Tags"}),placeholder:t(I("+Add tag")),model:Ut,name:"tags",allowCustomValue:!0,className:"mb-24"}),s.jsx(M,{name:"description",label:s.jsx(d,{message:"Description"}),inputElementType:"textarea",rows:5,className:"mb-24"}),e&&s.jsx(gr,{})]})]}),s.jsx(fr,{})]})}function gr(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}function yi({wrapInContainer:e}){const t=yt({loader:"editAlbumPage"});return t.data?s.jsx(me,{children:s.jsx(jr,{album:t.data.album,wrapInContainer:e})}):s.jsx(bs,{query:t,loaderIsScreen:!1,loaderClassName:"absolute inset-0 m-auto"})}function jr({album:e,wrapInContainer:t}){const{canEdit:a}=Za(e),n=!!R(c=>c.activeUploadsCount),r=re({defaultValues:{image:e.image,name:e.name,release_date:e.release_date,artists:e.artists,genres:e.genres,tags:e.tags,description:e.description,spotify_id:e.spotify_id,tracks:e.tracks}}),i=dr(r,e.id);return a?s.jsx(Ve,{form:r,onSubmit:c=>{i.mutate(c)},title:s.jsx(d,{message:"Edit “:name“ album",values:{name:e.name}}),isLoading:i.isPending||n,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(As,{showExternalIdFields:!0})}):s.jsx(vs,{to:"/",replace:!0})}const br=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=kt(),i=Fe(),[c,l]=u.useState(!1),o=re({defaultValues:{tracks:[],artists:r?[r]:[],release_date:i.toAbsoluteString()}}),f=o.watch("tracks")||[],m=R(y=>y.abortUpload),x=!!R(y=>y.activeUploadsCount),{openFilePicker:p,uploadTracks:h,validateUploads:g}=ts({onUploadStart:y=>{l(!0),o.setValue("tracks",[...o.getValues("tracks"),y]),e()},onMetadataChange:(y,k)=>{Ht(o,k),o.setValue("tracks",o.getValues("tracks").map(w=>w.uploadId===y.id?Ne(k,w):w))}});u.useImperativeHandle(n,()=>({openFilePicker:p,uploadTracks:h,validateUploads:g}),[p,h,g]);const j=Qt(o);return c?s.jsxs(Se,{className:"rounded border p-14 md:p-24 mb-30 bg-paper",form:o,onSubmit:y=>j.mutate(y,{onSuccess:k=>{l(!1),o.reset(),a(k.album)}}),children:[s.jsx(As,{showExternalIdFields:!1}),s.jsxs("div",{className:"mt-24",children:[s.jsx(V,{variant:"text",onClick:()=>{f.forEach(y=>{m(y.uploadId)}),o.reset(),l(!1),t()},className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:x||j.isPending,children:s.jsx(d,{message:"Save"})})]})]}):null}),vr=u.forwardRef(({onUploadStart:e,onCancel:t,onCreate:a},n)=>{const r=kt(),i=R(x=>x.abortUpload),[c,l]=u.useState([]),{openFilePicker:o,uploadTracks:f,validateUploads:m}=ts({onUploadStart:x=>{l(p=>r?[...p,{...x,artists:[r]}]:[...p,x]),e()},onMetadataChange:(x,p)=>{l(h=>h.map(g=>g.uploadId===x.id?Ne(p,g):g))}});return u.useImperativeHandle(n,()=>({openFilePicker:o,uploadTracks:f,validateUploads:m}),[o,f,m]),s.jsx("div",{className:"w-full",children:c.map(x=>s.jsx(yr,{track:x,onCreate:p=>{l(h=>h.filter(g=>g.uploadId!==x.uploadId)),a(p)},onRemove:()=>{l(p=>{const h=p.filter(g=>g.uploadId!==x.uploadId);return h.length||t(),h}),i(x.uploadId)}},x.uploadId))})}),yr=u.memo(({track:e,onRemove:t,onCreate:a})=>{const n=re({defaultValues:e}),r=Bt(n),i=R(f=>f.fileUploads.get(e.uploadId)),{isUploading:c,status:l}=Ps(e.uploadId);u.useEffect(()=>{n.reset(e)},[e,n]);const o=c&&i?s.jsx(Ot,{fileUpload:i,status:l}):null;return s.jsxs(Se,{form:n,onSubmit:f=>{r.mutate(f,{onSuccess:m=>a(m.track)})},className:"rounded border p-14 md:p-24 mb-30 bg-paper",children:[s.jsx($e,{uploadButton:o,showExternalIdFields:!1}),s.jsx(V,{variant:"text",onClick:()=>t(),className:"mr-10",children:s.jsx(d,{message:"Cancel"})}),s.jsx(V,{type:"submit",variant:"flat",color:"primary",disabled:r.isPending||!n.watch("src"),children:s.jsx(d,{message:"Save"})})]})}),kr=""+new URL("album-border-b5dd7d9f.png",import.meta.url).href;function wr({media:e}){var n,r;const t=e.model_type===Ya,a=t?He(e,{absolute:!0}):Oe(e,{absolute:!0});return s.jsxs("div",{className:"flex items-center gap-28 border rounded bg-paper p-20 my-20 mx-auto w-780 max-w-full",children:[s.jsxs("div",{className:S(t&&"relative isolate my-14 mx-18"),children:[t?s.jsx(es,{album:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}):s.jsx(Is,{track:e,className:"rounded flex-shrink-0 z-20 relative",size:"w-132 h-132"}),t&&s.jsx("img",{className:"absolute block w-160 h-160 max-w-160 -top-14 -left-14 z-10",src:kr,alt:""})]}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:"text-base font-bold",children:e.name}),s.jsx("div",{className:"text-muted text-sm mb-14",children:s.jsx(ss,{artists:e.artists})}),(n=e.genres)!=null&&n.length?s.jsx(bt,{selectable:!1,size:"sm",className:"mb-14",children:(r=e.genres)==null?void 0:r.map(i=>s.jsx(ot,{children:i.display_name||i.name},i.id))}):null,s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Upload complete. <a>Go to your track</a>",values:{a:i=>s.jsx(Z,{className:xt,to:t?He(e):Oe(e),children:i})}})})]}),s.jsx("div",{className:"ml-auto flex-auto max-w-300",children:s.jsxs("div",{className:"text-muted text-sm",children:[s.jsx(d,{message:"Share your new track"}),s.jsx(Ja,{name:e.name,image:e.image,link:a}),s.jsx(Aa,{value:a,readOnly:!0,className:"mt-24 w-full",size:"sm",onClick:i=>{i.target.select()}})]})})]})}function Nr({isVisible:e}){const t=s.jsx(X.div,{...ps,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:s.jsx(X.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:s.jsx(d,{message:"Drop your files anywhere on the page to upload"})})},"dragTargetMask");return s.jsx(Ze,{children:e?t:null})}function Ir(){const{user:e}=je();e!=null&&e.id&&de.resetQueries({queryKey:["minutesLimit",e.id]})}function Cr(){const{user:e}=Ta(),t=e==null?void 0:e.id;return ne({queryKey:["minutesLimit",t],queryFn:()=>Dr(t),enabled:t!=null})}function Dr(e){return L.get(`users/${e}/minutes-left`).then(t=>t.data)}const Pr=""+new URL("light-bg-8c37cb47.svg",import.meta.url).href,Sr=""+new URL("dark-bg-38ecc414.svg",import.meta.url).href;function Ar({children:e,...t}){const a=Fa();return s.jsxs("div",{className:"h-screen flex flex-col",...t,children:[s.jsx(ft,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",style:{backgroundImage:`url(${a?Sr:Pr})`},children:s.jsxs("div",{className:"container mx-auto p-14 md:p-24 min-h-full flex flex-col",children:[s.jsx("div",{className:"flex-auto",children:e}),s.jsx(ht,{})]})})]})}function ki({backstageLayout:e=!0}){return s.jsx(me,{children:s.jsx(Tr,{backstageLayout:e})})}function Tr({backstageLayout:e}){const[t,a]=u.useState("tracks"),[n,r]=u.useState(!1),i=u.useRef(null),c=t==="tracks"?vr:br,[l,o]=u.useState([]),f=u.useRef(null),[m,x]=u.useState(!1),{droppableProps:p}=Xa({id:"uploadPageRoot",ref:f,types:["nativeFile"],onDragEnter:()=>x(!0),onDragLeave:()=>x(!1),onDrop:async g=>{var j,y;if(g.type==="nativeFile"){const k=await g.getData(),w=(j=i.current)==null?void 0:j.validateUploads(k);w!=null&&w.length&&((y=i.current)==null||y.uploadTracks(w))}}}),h=e?Ar:Vr;return s.jsxs(h,{...p,children:[!n&&s.jsx(Fr,{onUpload:()=>{var g;return(g=i.current)==null?void 0:g.openFilePicker()},uploadMode:t,onUploadModeChange:a}),l.map(g=>s.jsx(wr,{media:g},g.id)),s.jsx(c,{ref:i,onUploadStart:()=>r(!0),onCreate:g=>{o(j=>[...j,g]),Ir()},onCancel:()=>{r(!1)}}),s.jsx(Nr,{isVisible:m})]})}function Fr({onUpload:e,uploadMode:t,onUploadModeChange:a}){const{data:n}=Cr();return s.jsxs("div",{className:"pt-40",children:[s.jsxs("div",{className:"border rounded p-20 md:p-48 flex flex-col items-center max-w-580 mx-auto bg-paper",children:[s.jsx("h1",{className:"text-base md:text-[22px] md:font-light",children:s.jsx(d,{message:"Drag and drop your tracks, videos & albums here."})}),s.jsx(V,{variant:"flat",color:"primary",className:"mt-20 w-min",onClick:()=>e(),children:s.jsx(d,{message:"Or choose files to upload"})}),s.jsx("div",{className:"border-t pt-20 mt-20",children:s.jsx(jt,{checked:t==="album",onChange:r=>a(r.target.checked?"album":"tracks"),children:s.jsx(d,{message:"Make an album when multiple files are selected"})})})]}),s.jsx("div",{className:"text-muted mt-20 text-sm text-center min-h-20",children:(n==null?void 0:n.minutesLeft)!=null&&s.jsx(d,{message:"You have :count minutes left. Try <a>Pro accounts</a> to get more time and access to advanced features.",values:{count:n.minutesLeft,a:r=>s.jsx(Z,{className:xt,to:"/pricing",children:r})}})})]})}function Vr({children:e,...t}){return s.jsx("div",{...t,className:"min-h-full relative",children:s.jsx("div",{className:"container mx-auto p-14 md:p-24",children:e})})}function wi({wrapInContainer:e}){return s.jsx(me,{children:s.jsx($r,{wrapInContainer:e})})}function $r({wrapInContainer:e}){const t=!!R(m=>m.activeUploadsCount),a=Fe(),n=Te(),{pathname:r}=ue(),[i]=Va(),{data:c}=Rt(`normalized-models/artist/${i.get("artistId")}`,void 0,{enabled:!!i.get("artistId")}),l=c==null?void 0:c.model,o=re({defaultValues:{release_date:a.toAbsoluteString()}}),f=Qt(o);return u.useEffect(()=>{l&&o.reset({artists:[l]})},[l,o]),s.jsx(Ve,{form:o,onSubmit:m=>{f.mutate(m,{onSuccess:x=>{r.includes("admin")?n(l?`/admin/artists/${l.id}/edit`:"/admin/albums"):n(He(x.album))}})},title:s.jsx(d,{message:"Add new album"}),isLoading:f.isPending||t,disableSaveWhenNotDirty:!0,wrapInContainer:e,children:s.jsx(As,{showExternalIdFields:!0})})}function Ni(){const{requestId:e}=Xe();return ne({queryKey:["backstage-request",+e],queryFn:()=>Rr(e)})}function Rr(e){return L.get(`backstage-request/${e}`).then(t=>t.data)}const Ii=G(s.jsx("path",{d:"M7 3H4v3H2V1h5v2zm15 3V1h-5v2h3v3h2zM7 21H4v-3H2v5h5v-2zm13-3v3h-3v2h5v-5h-2zM17 6H7v12h10V6zm2 12c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v12zM15 8H9v2h6V8zm0 3H9v2h6v-2zm0 3H9v2h6v-2z"}),"DocumentScannerOutlined"),Yt=G(s.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger"),zr=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3",body:e=>s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx(es,{album:e,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),s.jsx(Cs,{album:e,target:"_blank"})]})},{key:"release_date",allowsSorting:!0,header:()=>s.jsx(d,{message:"Release date"}),body:e=>e.release_date?s.jsx($a,{date:e.release_date}):null},{key:"track_count",allowsSorting:!1,header:()=>s.jsx(d,{message:"Track count"}),body:e=>e.tracks_count?s.jsx(qe,{value:e.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>s.jsx(d,{message:"Plays"}),body:e=>e.plays?s.jsx(qe,{value:e.plays}):null},{key:"actions",header:()=>s.jsx(d,{message:"Actions"}),width:"w-84 flex-shrink-0",visibleInMode:"all",hideHeader:!0,align:"end",body:e=>s.jsx(Lr,{album:e})}];function Mr({albums:e=[]}){const{watch:t}=Pe(),a=t("id"),{data:n,sortDescriptor:r,onSortChange:i}=en(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"my-24",children:[s.jsxs("div",{className:"flex items-center gap-12",children:[s.jsx("h2",{className:"text-xl font-semibold",children:s.jsx(d,{message:"Albums"})}),s.jsx(V,{variant:"outline",color:"primary",size:"xs",className:"ml-auto",startIcon:s.jsx(Ns,{}),elementType:a?Z:void 0,to:`../../../albums/new?artistId=${a}`,relative:"path",disabled:!a,children:s.jsx(d,{message:"Add album"})})]}),!a&&s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsx(Yt,{viewBox:"0 0 16 16",size:"xs",className:"text-muted"}),s.jsx(d,{message:"Save changes to enable album creation."})]})]}),s.jsx(sn,{columns:zr,data:e,sortDescriptor:r,onSortChange:i,enableSelection:!1}),n.length?null:s.jsx(dt,{className:"mt-40",image:s.jsx(ut,{src:Mt}),title:s.jsx(d,{message:"This artist does not have any albums yet"})})]})}function Lr({album:e}){const t=tn();return s.jsxs("div",{className:"text-muted",children:[s.jsx(Z,{to:`../../../albums/${e.id}/edit`,relative:"path",children:s.jsx(q,{size:"md",children:s.jsx(Ds,{})})}),s.jsxs(ee,{type:"modal",onClose:a=>{a&&t.mutate({albumId:e.id})},children:[s.jsx(q,{size:"md",disabled:t.isPending,children:s.jsx(js,{})}),s.jsx(mt,{isDanger:!0,title:s.jsx(d,{message:"Delete album"}),body:s.jsx(d,{message:"Are you sure you want to delete this album?"}),confirm:s.jsx(d,{message:"Delete"})})]})]})}function Ur({albums:e,showExternalFields:t}){const a=te();return s.jsxs(me,{children:[s.jsxs("div",{className:"md:flex gap-24",children:[s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx(Je,{name:"image_small",diskPrefix:"artist_images",label:a?s.jsx(d,{message:"Image"}):null,variant:a?"input":"square",previewSize:a?void 0:"w-full md:w-224 aspect-square",stretchPreview:!0}),t&&s.jsx(an,{name:"verified",className:"mt-14",children:s.jsx(d,{message:"Verified"})})]}),s.jsx("div",{className:"flex-auto mt-24 md:mt-0",children:s.jsxs(nn,{isLazy:!0,children:[s.jsxs(rn,{children:[s.jsx(Re,{children:s.jsx(d,{message:"Details"})}),s.jsx(Re,{children:s.jsx(d,{message:"Links"})}),s.jsx(Re,{children:s.jsx(d,{message:"Biography"})}),s.jsx(Re,{children:s.jsx(d,{message:"Images"})})]}),s.jsxs(ln,{className:"pt-20",children:[s.jsx(ze,{children:s.jsx(Er,{showExternalFields:t})}),s.jsx(ze,{children:s.jsx(on,{})}),s.jsx(ze,{children:s.jsx(_r,{})}),s.jsx(ze,{children:s.jsx(Or,{})})]})]})})]}),s.jsx(Mr,{albums:e})]})}function Er({showExternalFields:e}){const{trans:t}=_();return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"name",label:s.jsx(d,{message:"Name"}),className:"mb-24",required:!0,autoFocus:!0,disabled:!e}),s.jsx(we,{label:s.jsx(d,{message:"Genres"}),placeholder:t(I("+Add genre")),model:ws,name:"genres",allowCustomValue:!0,className:"mb-24"}),e&&s.jsx(Hr,{})]})}function _r(){return s.jsxs(u.Fragment,{children:[s.jsx(M,{name:"profile.country",label:s.jsx(d,{message:"Country"}),className:"mb-24"}),s.jsx(M,{name:"profile.city",label:s.jsx(d,{message:"City"}),className:"mb-24"}),s.jsx(M,{inputElementType:"textarea",rows:5,name:"profile.description",label:s.jsx(d,{message:"Description"}),className:"mb-24"})]})}function Or(){const{fields:e,append:t,remove:a}=ct({name:"profile_images"});return s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-12 flex-wrap mb-24",children:e.map((n,r)=>s.jsx(Je,{name:`profile_images.${r}.url`,diskPrefix:"artist_images",variant:"square",previewSize:"w-160 h-160",stretchPreview:!0,showRemoveButton:!0,onChange:i=>{i||a(r)}},n.id))}),s.jsx(V,{variant:"outline",color:"primary",startIcon:s.jsx(Ns,{}),onClick:()=>{t({url:""})},children:s.jsx(d,{message:"Add another image"})})]})}function Hr(){const{spotify_is_setup:e}=oe();return e?s.jsx(M,{name:"spotify_id",label:s.jsx(d,{message:"Spotify ID"}),className:"mb-24",minLength:22,maxLength:22}):null}const qr=e=>`artists/${e}`;function Br(e){const{trans:t}=_(),a=Te(),{pathname:n}=ue();return ce({mutationFn:r=>Kr(r),onSuccess:r=>{se(t(I("Artist updated"))),de.invalidateQueries({queryKey:xe("artists")}),n.includes("admin")?a("/admin/artists"):a(Ra(r.artist))},onError:r=>Ae(r,e)})}function Kr({id:e,...t}){return L.put(qr(e),t).then(a=>a.data)}function Ci({wrapInContainer:e,showExternalFields:t}){const a=wt({loader:"editArtistPage"});return a.data?s.jsx(Wr,{response:a.data,wrapInContainer:e,showExternalFields:t}):s.jsx(bs,{query:a,loaderClassName:"absolute inset-0 m-auto"})}function Wr({response:e,wrapInContainer:t,showExternalFields:a}){var c;const{canEdit:n}=cn(e.artist),r=re({defaultValues:{id:e.artist.id,name:e.artist.name,verified:e.artist.verified,spotify_id:e.artist.spotify_id,genres:e.artist.genres,image_small:e.artist.image_small,links:e.artist.links,profile:e.artist.profile,profile_images:e.artist.profile_images}}),i=Br(r);return n?s.jsx(Ve,{form:r,onSubmit:l=>{i.mutate(l)},title:s.jsx(d,{message:"Edit “:name“ artist",values:{name:e.artist.name}}),isLoading:i.isPending,disableSaveWhenNotDirty:!0,wrapInContainer:t,children:s.jsx(Ur,{albums:(c=e.albums)==null?void 0:c.data,showExternalFields:a})}):s.jsx(vs,{to:"/",replace:!0})}const Gr={month:"short",day:"2-digit"};function Qr({value:e,onChange:t,disabled:a,compactOnMobile:n=!0,enableCompare:r=!1,granularity:i="minute"}){const c=te();return s.jsxs(ee,{type:"popover",onClose:l=>{l&&t(l)},children:[s.jsx(V,{variant:"outline",color:"chip",endIcon:s.jsx(Dt,{}),disabled:a,children:s.jsx(Ft,{start:e.start,end:e.end,options:c&&n?Gr:nt.short})}),s.jsx(Zr,{value:e,enableCompare:r,granularity:i})]})}function Zr({value:e,enableCompare:t,granularity:a}){const n=te(),r=_s({granularity:a,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,c=_s({granularity:a,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:Vt[0].getRangeValue(r.selectedValue)});return s.jsx(Cn,{state:r,compareState:t?c:void 0,compareVisibleDefault:i,showInlineDatePickerField:!n})}function Ts(e){const{title:t,description:a,children:n,className:r,contentIsFlex:i=!0,contentClassName:c,contentRef:l,minHeight:o="min-h-440"}=e;return s.jsxs("div",{className:S("rounded-panel flex h-full flex-auto flex-col border bg",o,r),children:[s.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[s.jsx("div",{className:"text-sm font-semibold",children:t}),a&&s.jsx("div",{className:"text-muted",children:a})]}),s.jsx("div",{ref:l,className:S("relative p-14",i&&"flex flex-auto items-center justify-center",c),children:n})]})}function Be(){return s.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[s.jsx(gs,{isIndeterminate:!0,size:"sm"}),s.jsx(d,{message:"Chart loading"})]})}const Yr=u.lazy(()=>za(()=>import("./lazy-chart-edde6329.js"),["./lazy-chart-edde6329.js","./main-0b7be7a7.js","./main-d0db0534.css"],import.meta.url));function Jt(e){const{title:t,description:a,className:n,contentRef:r,isLoading:i}=e;return s.jsx(Ts,{title:t,description:a,className:n,contentRef:r,children:s.jsxs(u.Suspense,{fallback:s.jsx(Be,{}),children:[s.jsx(Yr,{...e}),i&&s.jsx(Be,{})]})})}function Xt(e,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const c=r.data.map((l,o)=>{let f;return i===0||!a?(f=Jr(l,e.granularity,t),n[o]=f):f=n[o],{...f,value:l.value}});return{...r,data:c}})}}function Jr(e,t,a){return e.label?{label:e.label}:e.date?Xr(e,t,a):{label:""}}function Xr({date:e,endDate:t},a="day",n){const r=_e(e).toDate(),i=t?_e(t).toDate():null;switch(a){case"minute":return{label:E(n,{second:"2-digit"}).format(r),tooltipTitle:E(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:E(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:E(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:E(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:E(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:E(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:E(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,i)};case"month":return{label:E(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:E(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:E(n,{year:"numeric"}).format(r),tooltipTitle:E(n,{year:"numeric"}).format(r)}}}const E=Ma((e,t)=>new La(e,t),{equals:(e,t)=>rt(e,t),callTimeout:void 0}),Ws=je().themes.all[0].values["--be-primary"],ge=[[`rgb(${Ws.replaceAll(" ",",")})`,`rgba(${Ws.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],ei={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function si({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{const i=Xt(e,{localeCode:n});return i.datasets=i.datasets.map((c,l)=>({...c,backgroundColor:ge[l][1],borderColor:ge[l][0],pointBackgroundColor:ge[l][0]})),i},[e,n]);return s.jsx(Jt,{...a,className:S(t,"min-w-500"),data:r,type:"line",options:ei})}const ti={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Gs({data:e,className:t,...a}){const{localeCode:n}=ae(),r=u.useMemo(()=>{var c;const i=Xt(e,{localeCode:n});return i.labels=(c=i.datasets[0])==null?void 0:c.data.map(l=>l.label),i.datasets=i.datasets.map((l,o)=>({...l,backgroundColor:ge.map(f=>f[1]),borderColor:ge.map(f=>f[0]),borderWidth:2})),i},[e,n]);return s.jsx(Jt,{type:"polarArea",data:r,options:ti,className:S(t,"min-w-500"),...a})}const Qs="https://www.gstatic.com/charts/loader.js";function ai({placeholderRef:e,data:t,country:a,onCountrySelected:n}){const{trans:r}=_(),{analytics:i}=oe(),c=i==null?void 0:i.gchart_api_key,{selectedTheme:l}=Ua(),o=u.useRef(),f=!!n&&!a,m=u.useCallback(()=>{var y,k;if(typeof google>"u")return;const p=t.map(w=>[w.label,w.value]);p.unshift([r(a?I("City"):I("Country")),r(I("Clicks"))]);const h=`${Es(l.values["--be-paper"])}`,j={colorAxis:{colors:[`${Es(l.values["--be-primary"])}`]},backgroundColor:h,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:f};!o.current&&e.current&&((y=google==null?void 0:google.visualization)!=null&&y.GeoChart)&&(o.current=new google.visualization.GeoChart(e.current)),(k=o.current)==null||k.draw(google.visualization.arrayToDataTable(p),j)},[l,t,e,r,a,f]),x=u.useCallback(async()=>{Us.isLoadingOrLoaded(Qs)||(await Us.loadAsset(Qs,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:c}),m())},[c,m]);return u.useEffect(()=>(o.current&&n&&google.visualization.events.addListener(o.current,"regionClick",p=>n==null?void 0:n(p.region)),()=>{o.current&&google.visualization.events.removeAllListeners(o.current)}),[n,o.current]),u.useEffect(()=>{x()},[x]),u.useEffect(()=>{m()},[l,m,t]),{drawGoogleChart:m}}const ni=G(s.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBackOutlined");function ri({title:e,body:t,dialogSize:a="sm",className:n}){return s.jsxs(ee,{type:"popover",triggerOnHover:!0,children:[s.jsx(q,{className:S("text-muted opacity-70",n),size:"xs",children:s.jsx(Yt,{viewBox:"0 0 16 16"})}),s.jsxs(Ce,{size:a,children:[e&&s.jsx(ys,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),s.jsx(De,{children:t})]})]})}const ii=u.memo(({code:e})=>{const{localeCode:t}=ae(),a=new Intl.DisplayNames([t],{type:"region"});let n;try{n=a.of(e.toUpperCase())}catch{}return s.jsx(u.Fragment,{children:n})});function li({data:e,isLoading:t,onCountrySelected:a,country:n,...r}){const i=u.useRef(null),c=!!a,l=e==null?void 0:e.datasets[0].data,o=u.useMemo(()=>l||[],[l]);return ai({placeholderRef:i,data:o,country:n,onCountrySelected:a}),s.jsxs(Ts,{...r,className:"min-w-500",title:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{message:"Top Locations"}),n?s.jsxs("span",{className:"pl-4",children:["(",s.jsx(ii,{code:n}),")"]}):null,c&&s.jsx(oi,{})]}),contentIsFlex:t,children:[t&&s.jsx(Be,{}),s.jsxs("div",{className:"flex gap-24",children:[s.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),s.jsxs("div",{className:"w-[170px]",children:[s.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:o.map(f=>s.jsxs("div",{className:S("flex items-center gap-4 mb-4",c&&"cursor-pointer hover:underline"),role:c?"button":void 0,onClick:()=>{a==null||a(f.code)},children:[s.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:f.label}),s.jsxs("div",{children:["(",f.percentage,")%"]})]},f.label))}),n&&s.jsx(V,{variant:"outline",size:"xs",className:"mt-14",startIcon:s.jsx(ni,{}),onClick:()=>{a==null||a(void 0)},children:s.jsx(d,{message:"Back to countries"})})]})]})]})}function oi(){return s.jsx(ri,{title:s.jsx(d,{message:"Zooming in"}),body:s.jsx(d,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const Zs="reports/insights";function ci(e,t){return ne({queryKey:[Zs,e],queryFn:()=>di(Zs,e),placeholderData:t.isEnabled?Ye:void 0,enabled:t.isEnabled})}function di(e,t){var n;const a={model:t.model,metrics:(n=t.metrics)==null?void 0:n.join(",")};return a.startDate=t.dateRange.start.toAbsoluteString(),a.endDate=t.dateRange.end.toAbsoluteString(),a.timezone=t.dateRange.start.timeZone,L.get(e,{params:a}).then(r=>r.data)}const ui=G(s.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");function Le({data:e,isLoading:t,...a}){const n=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(Ts,{...a,className:"min-w-500 md:min-w-0 w-1/2",contentIsFlex:t,contentClassName:"max-h-[370px] overflow-y-auto compact-scrollbar",children:[t&&s.jsx(Be,{}),n.map(r=>s.jsxs("div",{className:"mb-20 text-sm flex items-center justify-between gap-24",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(mi,{model:r.model,size:"w-42 h-42",className:"rounded flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(xi,{model:r.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(fi,{model:r.model})})]})]}),s.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[s.jsx(dn,{className:"text-muted",size:"sm"}),s.jsx(d,{message:":count plays",values:{count:s.jsx(qe,{value:r.value})}})]})]},r.model.id)),!t&&!n.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(ui,{size:"sm"}),s.jsx(d,{message:"No plays in selected timeframe."})]}):null]})}function mi({model:e,size:t,className:a}){const{pathname:n}=ue(),i=n.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(Z,{to:i,children:s.jsx(pt,{artist:e,size:t,className:a})});case"album":return s.jsx(Z,{to:i,children:s.jsx(es,{album:e,size:t,className:a})});case"track":return s.jsx(Z,{to:i,children:s.jsx(Is,{track:e,size:t,className:a})});case"user":return s.jsx(un,{user:e,size:t,className:a})}}function xi({model:e}){switch(e.model_type){case"artist":return s.jsx(gt,{artist:e,target:"_blank"});case"album":return s.jsx(Cs,{album:e,target:"_blank"});case"track":return s.jsx(Nt,{track:e,target:"_blank"});case"user":return e.id?s.jsx(Ea,{user:e,target:"_blank"}):s.jsx(u.Fragment,{children:e.display_name})}}function fi({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(ss,{artists:e.artists,target:"_blank"})}}function Fs(e){const a="flex flex-col lg:flex-row lg:items-center overflow-x-auto gap-12 md:gap-24 mb-12 md:mb-24",n=e.model,r=e.dateRange;return s.jsxs(u.Fragment,{children:[s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"plays",model:n,dateRange:r,children:({data:i})=>s.jsx(si,{className:"flex-auto",title:s.jsx(d,{message:"Plays"}),hideLegend:!0,description:s.jsx(d,{message:":count total plays",values:{count:s.jsx(qe,{value:(i==null?void 0:i.report.plays.total)||0})}})})}),s.jsx(W,{metric:"devices",model:n,dateRange:r,children:s.jsx(Gs,{title:s.jsx(d,{message:"Top devices"})})})]}),s.jsxs("div",{className:a,children:[e.showTracks&&s.jsx(W,{metric:"tracks",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played tracks"})})}),s.jsx(W,{metric:"users",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Top listeners"})})})]}),e.showArtistsAndAlbums&&s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"artists",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played artists"})})}),s.jsx(W,{metric:"albums",model:n,dateRange:r,children:s.jsx(Le,{title:s.jsx(d,{message:"Most played albums"})})})]}),s.jsxs("div",{className:a,children:[s.jsx(W,{metric:"locations",model:n,dateRange:r,children:s.jsx(li,{className:"flex-auto w-1/2 lg:max-w-[740px]"})}),s.jsx(W,{metric:"platforms",model:n,dateRange:r,children:s.jsx(Gs,{className:"max-w-500",title:s.jsx(d,{message:"Top platforms"})})})]})]})}function W({children:e,metric:t,model:a,dateRange:n}){var m,x;const[r,i]=u.useState(!1),c=ci({metrics:[t],model:a,dateRange:n},{isEnabled:r}),l=typeof e=="function"?e(c):e,o=u.useRef(),f=u.useCallback(p=>{var h;if(p){const g=new IntersectionObserver(([j])=>{var y;j.isIntersecting&&(i(!0),(y=o.current)==null||y.disconnect(),o.current=void 0)},{threshold:.1});o.current=g,g.observe(p)}else o.current&&((h=o.current)==null||h.disconnect())},[]);return u.cloneElement(l,{data:(x=(m=c.data)==null?void 0:m.report)==null?void 0:x[t],isLoading:c.isLoading,contentRef:f})}function Vs({children:e,reportModel:t,title:a,isNested:n}){const[r,i]=u.useState(()=>Ct[2].getRangeValue());return s.jsxs(u.Fragment,{children:[s.jsx(_a,{children:s.jsx(d,{message:"Insights"})}),s.jsxs("div",{className:"h-full flex flex-col",children:[!n&&s.jsx(ft,{className:"flex-shrink-0",color:"bg",darkModeColor:"bg"}),s.jsx("div",{className:"overflow-y-auto flex-auto bg-cover relative",children:s.jsxs("div",{className:"min-h-full p-12 md:p-24 overflow-x-hidden max-w-[1600px] mx-auto flex flex-col",children:[s.jsxs("div",{className:"flex-auto",children:[s.jsxs("div",{className:"md:flex items-center justify-between gap-24 h-48 mt-14 mb-38",children:[a||s.jsx(pe,{className:"max-w-320"}),s.jsx("div",{className:"flex-shrink-0 flex items-center justify-between gap-10 md:gap-24",children:s.jsx(Qr,{value:r,onChange:i})})]}),u.cloneElement(e,{dateRange:r,model:t})]}),!n&&s.jsx(ht,{})]})})]})]})}function $s({image:e,name:t,description:a}){return s.jsxs("div",{className:"flex items-center gap-10",children:[u.cloneElement(e,{size:"w-48 h-48",className:"rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-base whitespace-nowrap overflow-hidden overflow-ellipsis",children:["“",t,"“ ",s.jsx(d,{message:"insights"})]}),a&&s.jsx("div",{className:"text-muted text-sm",children:a})]})]})}function Di({isNested:e}){const{artistId:t}=Xe(),{data:a}=wt({loader:"artist"});return s.jsx(Vs,{reportModel:`artist=${t}`,title:(a==null?void 0:a.artist)&&s.jsx($s,{image:s.jsx(pt,{artist:a.artist}),name:s.jsx(gt,{artist:a.artist})}),isNested:e,children:s.jsx(Fs,{showTracks:!0})})}function Pi({isNested:e}){const{albumId:t}=Xe(),{data:a}=yt({loader:"album"});return s.jsx(Vs,{reportModel:`album=${t}`,title:(a==null?void 0:a.album)&&s.jsx($s,{image:s.jsx(es,{album:a.album}),name:s.jsx(Cs,{album:a.album}),description:s.jsx(ss,{artists:a.album.artists})}),isNested:e,children:s.jsx(Fs,{showTracks:!0})})}function Si({isNested:e}){const{trackId:t}=Xe(),{data:a}=vt({loader:"track"});return s.jsx(Vs,{reportModel:`track=${t}`,title:(a==null?void 0:a.track)&&s.jsx($s,{image:s.jsx(Is,{track:a.track}),name:s.jsx(Nt,{track:a.track}),description:s.jsx(ss,{artists:a.track.artists})}),isNested:e,children:s.jsx(Fs,{})})}export{fn as A,Jt as B,Un as C,Cn as D,Pi as E,$n as F,li as G,Ci as H,Fs as I,Di as J,ki as K,si as L,Bn as M,ni as N,Ar as O,Gs as P,Et as Q,Qr as R,ui as S,vi as U,St as a,Dt as b,cs as c,Ct as d,zt as e,Ft as f,Rt as g,ji as h,xe as i,On as j,qn as k,Fe as l,Ve as m,$t as n,Mt as o,Ni as p,Ii as q,Ur as r,Xt as s,ge as t,_s as u,ri as v,bi as w,Si as x,wi as y,yi as z};
//# sourceMappingURL=backstage-track-insights-6a8a7ef9.js.map
